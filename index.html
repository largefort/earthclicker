<html><head><base href="https://websim.example.com/three-js-planet-idle-v7/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Three.js Planet Idle Game with Zoom and Animals</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<style>
 body, html {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Roboto', sans-serif;
    }
    #game-container {
      position: relative;
      width: 100%;
      height: calc(100% - 70px);
      transform: translateZ(0);
      backface-visibility: hidden;
      perspective: 1000;
    }
    #mobile-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: linear-gradient(to top, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      padding: 0 10px;
      transform: translateZ(0);
    }
    .nav-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 15px;
      padding: 12px 20px;
      border-radius: 25px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      outline: none;
    }
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }
    .nav-btn.active {
      background: linear-gradient(45deg, #4a90e2, #67b26f);
      border: none;
      color: white;
      box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
    }
    #tab-content {
      height: 100%;
    }
    .tab-pane {
      display: none;
      height: 100%;
      overflow-y: auto;
      transition: opacity 0.3s ease;
      opacity: 0;
    }
    .tab-pane.active {
      display: block;
      opacity: 1;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      max-width: 80%;
      margin: 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    #upgrades, #sidebar, #stats-container {
      background-color: rgba(74, 74, 138, 0.9);
      border-radius: 10px;
      margin: 10px;
      padding: 15px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .upgrade-btn, .game-btn {
      margin: 5px;
      padding: 15px;
      background: linear-gradient(45deg, rgba(74, 144, 226, 0.1), rgba(103, 178, 111, 0.1));
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
    }
    .upgrade-btn:hover, .game-btn:hover {
      background: linear-gradient(45deg, rgba(74, 144, 226, 0.2), rgba(103, 178, 111, 0.2));
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    #upgrade-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding-bottom: 70px;
    }
    #game-controls {
    display: flex;
    flex-direction: column;
  }
    #life-counter {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(45deg, #4a90e2, #67b26f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: none;
    }
    #humans-counter, #animals-counter, #lps-counter {
      font-size: 16px;
      margin-bottom: 4px;
      color: #00ccff;
    }
    #time-counter {
      font-size: 14px;
      margin-top: 8px;
      color: #ffd700;
    }
     .click-text {
    position: absolute;
    font-size: 20px;
    color: #00ff00;
    pointer-events: none;
    z-index: 1000;
    will-change: transform, opacity;
  }
  .life-particle {
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: #00ff00;
    border-radius: 50%;
    pointer-events: none;
    z-index: 1000;
    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
    will-change: transform, opacity;
  }
    #offline-progress-notification {
      position: fixed;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(74, 74, 138, 0.9);
      color: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      z-index: 1001;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
    }
    #offline-progress-notification p {
      margin: 5px 0;
    }
    @media (max-width: 768px) {
      #game-container {
        height: calc(100% - 60px);
      }
      #hud {
        max-width: 90%;
        padding: 10px;
        margin: 10px;
      }
      #life-counter {
        font-size: 28px;
      }
      #humans-counter, #animals-counter, #lps-counter {
        font-size: 14px;
      }
      #time-counter {
        font-size: 12px;
      }
      .upgrade-btn, .game-btn {
        font-size: 14px;
        padding: 12px;
      }
    }
    #stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      padding-bottom: 70px;
    }
    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      transition: transform 0.3s ease;
    }
    .stat-item:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.08);
    }
    #ad-container {
      width: 100%;
      max-width: 728px;
      margin: 20px auto;
      text-align: center;
      background-color: rgba(74, 74, 138, 0.9);
      border-radius: 10px;
      padding: 10px;
    }
    #vignette-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
      background: radial-gradient(circle, transparent 50%, rgba(0,0,0,0.8) 150%);
    }
    #vignette-overlay.active {
      opacity: 1;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      z-index: 1001;
    }
    .loading-spinner {
      border: 8px solid rgba(255, 255, 255, 0.1);
      border-top: 8px solid #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      margin-top: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  .game-btn {
    margin-bottom: 10px;
    padding: 10px;
    background-color: #4a4a8a;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s;
    font-size: 14px;
  }
  .game-btn:hover {
    background-color: #5a5a9a;
  }
  /* Add Steam Deck optimized UI styles */
  @media (max-width: 1280px) {
    #hud {
      font-size: 120%;
      padding: 25px;
    }
    .upgrade-btn {
      padding: 20px 25px;
      font-size: 20px;
      margin: 8px 0;
    }
    #sidebar {
      width: 300px;
    }
    .game-btn {
      padding: 15px;
      font-size: 18px;
      margin-bottom: 15px;
    }
    /* Add gamepad focus indicators */
    .upgrade-btn:focus,
    .game-btn:focus {
      outline: 3px solid #00ff9d;
      transform: scale(1.05);
    }
  }
</style>
</head>
<body>
<div id="game-container">
  <div id="hud">
    <div id="life-counter">Life: 0</div>
    <div id="humans-counter">Humans: 0</div>
    <div id="animals-counter">Animals: 0</div>
    <div id="lps-counter">Life per second: 0</div>
    <div id="time-counter">Year 0, Day 0, 00:00:00</div>
  </div>
  <div id="upgrades">
    <button class="upgrade-btn" id="planet-upgrade">Upgrade Planet (Cost: 10 Life)</button>
    <button class="upgrade-btn" id="human-upgrade">Create Humans (Cost: 100 Life)</button>
    <button class="upgrade-btn" id="animal-upgrade">Create Animals (Cost: 50 Life)</button>
  </div>
  <div id="sidebar">
    <div>
      <div id="zoom-info">Zoom: Z (in) / O (out)</div>
      <div id="human-activity">Human Activity: Idle</div>
    </div>
    <div id="game-controls">
      <button class="game-btn" id="save-game">Save Game</button>
      <button class="game-btn" id="reset-game">Reset Game</button>
    </div>
  </div>
</div>

<script>
let steamClient = null;
let steamworks = window.steamworks;

async function initializeSteam() {
  // Only try to initialize Steam if running in Steam client
  if (window.steam && window.steamworks) {
    try {
      steamworks = window.steamworks;
      await steamworks.init(480); // Replace with your Steam App ID
      steamClient = steamworks;
      console.log('Steam initialized successfully');
      return true;
    } catch (err) {
      console.error('Steam initialization failed:', err);
      return false;
    }
  } else {
    console.log('Steam API not available - running in standard web mode');
    return false;
  }
}

// Modified save function for both Steam and local storage
async function saveGame() {
  const gameState = {
    life,
    humans,
    animals,
    planetsProduced,
    lifePerSecond,
    lifePerClick,
    planetUpgradeCost,
    humanUpgradeCost,
    animalUpgradeCost,
    gameSeconds,
    gameDays,
    gameYears
  };
  
  const saveData = JSON.stringify(gameState);
  
  // Try Steam Cloud first if available
  if (steamClient && steamworks.storage) {
    try {
      await steamworks.storage.writeFile('savedata.json', saveData);
      console.log('Game saved to Steam Cloud');
      return;
    } catch (err) {
      console.error('Steam cloud save failed:', err);
    }
  }
  
  // Fallback to local storage
  try {
    localStorage.setItem('planetIdleGame', saveData);
    console.log('Game saved to local storage');
  } catch (err) {
    console.error('Local storage save failed:', err);
  }
}

// Modified load function for both Steam and local storage
async function loadGame() {
  let savedState = null;
  
  // Try Steam Cloud first if available
  if (steamClient && steamworks.storage) {
    try {
      savedState = await steamworks.storage.readFile('savedata.json');
      console.log('Game loaded from Steam Cloud');
    } catch (err) {
      console.error('Steam cloud load failed:', err);
    }
  }
  
  // Fallback to local storage if Steam load failed or unavailable
  if (!savedState) {
    try {
      savedState = localStorage.getItem('planetIdleGame');
      if (savedState) {
        console.log('Game loaded from local storage');
      }
    } catch (err) {
      console.error('Local storage load failed:', err);
    }
  }
  
  if (savedState) {
    const gameState = JSON.parse(savedState);
    life = gameState.life;
    humans = gameState.humans;
    animals = gameState.animals;
    planetsProduced = gameState.planetsProduced;
    lifePerSecond = gameState.lifePerSecond;
    lifePerClick = gameState.lifePerClick;
    planetUpgradeCost = gameState.planetUpgradeCost;
    humanUpgradeCost = gameState.humanUpgradeCost;
    animalUpgradeCost = gameState.animalUpgradeCost;
    gameSeconds = gameState.gameSeconds || 0;
    gameDays = gameState.gameDays || 0;
    gameYears = gameState.gameYears || 0;
    updateCounters();
    document.getElementById('planet-upgrade').textContent = `Upgrade Planet (Cost: ${planetUpgradeCost} Life)`;
    document.getElementById('human-upgrade').textContent = `Create Humans (Cost: ${humanUpgradeCost} Life)`;
    document.getElementById('animal-upgrade').textContent = `Create Animals (Cost: ${animalUpgradeCost} Life)`;
    updateTimeCounter();
  }
}

// Gamepad/controller support
let selectedButton = 0;
const interactiveElements = [];

function initializeGamepadSupport() {
  interactiveElements.push(...document.querySelectorAll('.upgrade-btn, .game-btn'));
  if (interactiveElements.length > 0) {
    interactiveElements[0].focus();
  }
}

function handleGamepad() {
  const gamepads = navigator.getGamepads();
  if (!gamepads[0]) return;
  
  const gamepad = gamepads[0];
  
  if (gamepad.axes[1] < -0.5 || gamepad.axes[3] < -0.5) {
    selectedButton = Math.max(0, selectedButton - 1);
    interactiveElements[selectedButton].focus();
  }
  if (gamepad.axes[1] > 0.5 || gamepad.axes[3] > 0.5) {
    selectedButton = Math.min(interactiveElements.length - 1, selectedButton + 1);
    interactiveElements[selectedButton].focus();
  }
  
  if (gamepad.buttons[0].pressed) {
    interactiveElements[selectedButton].click();
  }
}

// Add new upgrades
const newUpgrades = {
  automationFactory: {
    cost: 500,
    lifePerSecond: 5,
    unlocked: false
  },
  researchLab: {
    cost: 1000,
    lifePerSecond: 10,
    unlocked: false
  },
  spaceStation: {
    cost: 5000,
    lifePerSecond: 50,
    unlocked: false
  }
};

// Add new upgrade buttons to HTML
function addNewUpgradeButtons() {
  const upgradesDiv = document.getElementById('upgrades');
  
  Object.entries(newUpgrades).forEach(([key, upgrade]) => {
    const button = document.createElement('button');
    button.className = 'upgrade-btn';
    button.id = `${key}-upgrade`;
    button.textContent = `Build ${key.replace(/([A-Z])/g, ' $1').trim()} (Cost: ${upgrade.cost} Life)`;
    button.style.display = 'none';
    upgradesDiv.appendChild(button);
    
    button.addEventListener('click', () => purchaseUpgrade(key));
  });
}

function purchaseUpgrade(upgradeKey) {
  const upgrade = newUpgrades[upgradeKey];
  if (life >= upgrade.cost && !upgrade.unlocked) {
    life -= upgrade.cost;
    upgrade.unlocked = true;
    lifePerSecond += upgrade.lifePerSecond;
    document.getElementById(`${upgradeKey}-upgrade`).style.display = 'none';
    updateCounters();
  }
}

// Main game loop with gamepad support
function gameLoop() {
  handleGamepad();
  requestAnimationFrame(gameLoop);
}

// Initialize everything
window.addEventListener('load', () => {
  initializeSteam();
  initializeGamepadSupport();
  addNewUpgradeButtons();
  gameLoop();
});

// Existing game logic below...
let life = 0;
let humans = 0;
let animals = 0;
let planetsProduced = 0;
let lifePerSecond = 0;
let lifePerClick = 1;
let planetUpgradeCost = 10;
let humanUpgradeCost = 100;
let animalUpgradeCost = 50;

// Time variables
let gameSeconds = 0;
let gameDays = 0;
let gameYears = 0;

// Initialize Three.js scene
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.getElementById('game-container').appendChild(renderer.domElement);

// Create a starfield background
const starsGeometry = new THREE.BufferGeometry();
const starsMaterial = new THREE.PointsMaterial({color: 0xFFFFFF, size: 0.1});

const starsVertices = [];
for (let i = 0; i < 10000; i++) {
  const x = (Math.random() - 0.5) * 2000;
  const y = (Math.random() - 0.5) * 2000;
  const z = (Math.random() - 0.5) * 2000;
  starsVertices.push(x, y, z);
}

starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
const starField = new THREE.Points(starsGeometry, starsMaterial);
scene.add(starField);

// Create Earth
const earthGeometry = new THREE.SphereGeometry(1, 64, 64);
const earthMaterial = new THREE.MeshPhongMaterial({
  map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg'),
  bumpMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_normal_2048.jpg'),
  bumpScale: 0.05,
  specularMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg'),
  specular: new THREE.Color('grey')
});
const earth = new THREE.Mesh(earthGeometry, earthMaterial);
scene.add(earth);

// Add clouds
const cloudGeometry = new THREE.SphereGeometry(1.01, 64, 64);
const cloudMaterial = new THREE.MeshPhongMaterial({
  map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png'),
  transparent: true,
  opacity: 0.8
});
const clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
earth.add(clouds);

// Create Moon
const moonGeometry = new THREE.SphereGeometry(0.27, 32, 32);
const moonMaterial = new THREE.MeshPhongMaterial({
  map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/moon_1024.jpg'),
  bumpMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/moon_bump.jpg'),
  bumpScale: 0.002,
});
const moon = new THREE.Mesh(moonGeometry, moonMaterial);
scene.add(moon);

// Moon orbit parameters
const moonOrbitRadius = 2.5;
let moonOrbitAngle = 0;
const moonOrbitSpeed = 0.001;

// Add ambient light
const ambientLight = new THREE.AmbientLight(0x404040);
scene.add(ambientLight);

// Add directional light (sun)
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(5, 3, 5);
scene.add(directionalLight);

camera.position.z = 5;

// Planet rotation
const rotationSpeed = 0.001; // Earth's rotation speed

// Mouse interaction variables
let isDragging = false;
let previousMousePosition = {
    x: 0,
    y: 0
};

// Zoom variables
let targetZoom = 5;
const zoomSpeed = 0.1;
const minZoom = 2;
const maxZoom = 10;

// Update time counter
function updateTimeCounter() {
  gameSeconds++;
  if (gameSeconds >= 86400) {
    gameSeconds = 0;
    gameDays++;
    if (gameDays >= 365) {
      gameDays = 0;
      gameYears++;
    }
  }

  const hours = Math.floor(gameSeconds / 3600);
  const minutes = Math.floor((gameSeconds % 3600) / 60);
  const seconds = gameSeconds % 60;

  const timeString = `Year ${gameYears}, Day ${gameDays}, ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  document.getElementById('time-counter').textContent = timeString;
}

// Animation loop
function animate() {
    requestAnimationFrame(animate);

    // Rotate Earth on its axis
    earth.rotation.y += rotationSpeed;
    clouds.rotation.y += rotationSpeed * 1.1;

    // Rotate Moon around Earth
    moonOrbitAngle += moonOrbitSpeed;
    moon.position.x = Math.cos(moonOrbitAngle) * moonOrbitRadius;
    moon.position.z = Math.sin(moonOrbitAngle) * moonOrbitRadius;
    moon.rotation.y += rotationSpeed * 0.1; // Moon's own rotation

    // Smooth zoom
    camera.position.z += (targetZoom - camera.position.z) * zoomSpeed;

    // Update time counter
    updateTimeCounter();

    renderer.render(scene, camera);
}
animate();

// Mouse-based rotation
renderer.domElement.addEventListener('mousedown', (e) => {
    isDragging = true;
});

renderer.domElement.addEventListener('mousemove', (e) => {
    if (isDragging) {
        const deltaMove = {
            x: e.offsetX - previousMousePosition.x,
            y: e.offsetY - previousMousePosition.y
        };

        earth.rotation.y += deltaMove.x * 0.005;
        earth.rotation.x += deltaMove.y * 0.005;
    }

    previousMousePosition = {
        x: e.offsetX,
        y: e.offsetY
    };
});

renderer.domElement.addEventListener('mouseup', (e) => {
    isDragging = false;
});

// Zoom controls
document.addEventListener('keydown', (e) => {
    if (e.key === 'z') {
        targetZoom = Math.max(targetZoom - 0.5, minZoom);
    } else if (e.key === 'o') {
        targetZoom = Math.min(targetZoom + 0.5, maxZoom);
    }
});

// Game logic
function updateCounters() {
  document.getElementById('life-counter').textContent = `Life: ${Math.floor(life)}`;
  document.getElementById('humans-counter').textContent = `Humans: ${humans}`;
  document.getElementById('animals-counter').textContent = `Animals: ${animals}`;
  document.getElementById('lps-counter').textContent = `Life per second: ${lifePerSecond.toFixed(1)}`;
}

function upgradePlanet() {
  if (life >= planetUpgradeCost) {
    life -= planetUpgradeCost;
    planetsProduced++;
    lifePerSecond += 0.1;
    planetUpgradeCost = Math.floor(planetUpgradeCost * 1.5);
    document.getElementById('planet-upgrade').textContent = `Upgrade Planet (Cost: ${planetUpgradeCost} Life)`;
    updateCounters();
  }
}

function createHumans() {
  if (life >= humanUpgradeCost) {
    life -= humanUpgradeCost;
    humans += 10;
    lifePerSecond += 1;
    humanUpgradeCost = Math.floor(humanUpgradeCost * 1.5);
    document.getElementById('human-upgrade').textContent = `Create Humans (Cost: ${humanUpgradeCost} Life)`;
    updateCounters();
  }
}

function createAnimals() {
  if (life >= animalUpgradeCost) {
    life -= animalUpgradeCost;
    animals += 5;
    lifePerSecond += 0.5;
    animalUpgradeCost = Math.floor(animalUpgradeCost * 1.3);
    document.getElementById('animal-upgrade').textContent = `Create Animals (Cost: ${animalUpgradeCost} Life)`;
    updateCounters();
  }
}

document.getElementById('planet-upgrade').addEventListener('click', upgradePlanet);
document.getElementById('human-upgrade').addEventListener('click', createHumans);
document.getElementById('animal-upgrade').addEventListener('click', createAnimals);

// Click anywhere to generate life
document.addEventListener('click', (event) => {
  life += lifePerClick;
  updateCounters();
  
  // Create click text
  const clickText = document.createElement('div');
  clickText.textContent = `+${lifePerClick}`;
  clickText.classList.add('click-text');
  clickText.style.left = `${event.clientX}px`;
  clickText.style.top = `${event.clientY}px`;
  document.body.appendChild(clickText);

  // Animate click text
  gsap.to(clickText, {
    opacity: 0,
    y: -50,
    duration: 1,
    onComplete: () => clickText.remove()
  });

  // Create life particle
  const particle = document.createElement('div');
  particle.classList.add('life-particle');
  particle.style.left = `${event.clientX}px`;
  particle.style.top = `${event.clientY}px`;
  document.body.appendChild(particle);

  // Get the position of the life counter
  const lifeCounter = document.getElementById('life-counter');
  const lifeCounterRect = lifeCounter.getBoundingClientRect();
  const targetX = lifeCounterRect.left + lifeCounterRect.width / 2;
  const targetY = lifeCounterRect.top + lifeCounterRect.height / 2;

  // Calculate the distance and duration based on the distance
  const distance = Math.sqrt(Math.pow(targetX - event.clientX, 2) + Math.pow(targetY - event.clientY, 2));
  const duration = Math.min(1, distance / 500); // Adjust the divisor to change the speed

  // Animate life particle
  gsap.to(particle, {
    x: targetX - event.clientX,
    y: targetY - event.clientY,
    opacity: 0,
    duration: duration,
    ease: 'power1.in',
    onComplete: () => particle.remove()
  });
});

// Auto-generate life
setInterval(() => {
  life += lifePerSecond;
  updateCounters();
}, 1000);

// Local Storage
// Auto-save every 30 seconds
setInterval(saveGame, 30000);

// Load game on start
loadGame();

// Reset game function
document.getElementById('reset-game').addEventListener('click', resetGame);

function resetGame() {
  if (confirm('Are you sure you want to reset the game? All progress will be lost.')) {
    localStorage.removeItem('planetIdleGame');
    location.reload();
  }
}

// Resize handler
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
