<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Planet Genesis - Advanced Idle Evolution Game</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&family=Ubuntu:wght@300;400;500;700&family=Liberation+Sans:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<style>
  :root {
    --primary-blue: #00e5ff;
    --primary-purple: #7c4dff;
    --primary-green: #00ff9d;
    --dark-bg: #0a0a0f;
    --darker-bg: #05050a;
    --card-bg: rgba(15, 25, 40, 0.85);
    --glass-bg: rgba(255, 255, 255, 0.05);
    --border-glow: rgba(0, 229, 255, 0.3);
    --text-primary: #ffffff;
    --text-secondary: #b0b0c0;
    --text-accent: #00e5ff;
    --success: #00ff88;
    --warning: #ffb800;
    --danger: #ff3366;
    --safe-area-inset-top: env(safe-area-inset-top);
    --safe-area-inset-bottom: env(safe-area-inset-bottom);
    --safe-area-inset-left: env(safe-area-inset-left);
    --safe-area-inset-right: env(safe-area-inset-right);
  }

  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: 'Inter', 'Ubuntu', 'Liberation Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
    color: var(--text-primary);
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
  }

  #game-container {
    position: relative;
    width: 100%;
    height: calc(100% - 80px);
    overflow: hidden;
    will-change: transform;
    transform: translateZ(0);
  }

  #mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 80px;
    background: linear-gradient(180deg, 
      rgba(10, 10, 15, 0.95) 0%, 
      rgba(5, 5, 10, 0.98) 100%);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--border-glow);
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
    padding: 0 20px;
    padding-bottom: max(0px, var(--safe-area-inset-bottom));
    padding-left: max(20px, calc(20px + var(--safe-area-inset-left)));
    padding-right: max(20px, calc(20px + var(--safe-area-inset-right)));
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
  }

  .nav-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 12px 8px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 12px;
    outline: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 22%;
    min-height: 56px;
    min-width: 56px;
    touch-action: manipulation;
  }

  .nav-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
    border-radius: 12px;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: -1;
  }

  .nav-btn:hover {
    color: var(--text-primary);
    transform: translateY(-3px);
  }

  .nav-btn:hover::before {
    opacity: 0.1;
    transform: translate(-50%, -50%) scale(1);
  }

  .nav-btn.active {
    color: var(--primary-blue);
    background: var(--glass-bg);
    box-shadow: 
      0 8px 25px rgba(0, 229, 255, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }

  .nav-btn.active::before {
    opacity: 0.15;
    transform: translate(-50%, -50%) scale(1);
  }

  .nav-btn.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 50%;
    width: 30px;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
    border-radius: 3px;
    transform: translateX(-50%);
    box-shadow: 0 0 15px var(--primary-blue);
  }

  #tab-content {
    height: 100%;
  }

  .tab-pane {
    display: none;
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  .tab-pane.active {
    display: block;
  }

  #hud {
    position: absolute;
    top: max(20px, var(--safe-area-inset-top));
    left: 50%;
    transform: translateX(-50%);
    width: auto;
    max-width: 85%;
    margin: 0;
    padding: 20px 25px;
    background: var(--card-bg);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    text-align: center;
    border: 1px solid var(--border-glow);
    box-shadow: 
      0 15px 35px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  #upgrades, #sidebar, #stats-container {
    background: var(--card-bg);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    margin: 15px;
    padding: 25px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid var(--border-glow);
    box-shadow: 
      0 20px 40px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .upgrade-btn, .game-btn {
    margin: 8px;
    padding: 16px;
    background: linear-gradient(135deg, 
      rgba(124, 77, 255, 0.1) 0%, 
      rgba(0, 229, 255, 0.05) 100%);
    color: var(--text-primary);
    border: 1px solid rgba(124, 77, 255, 0.3);
    cursor: pointer;
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 14px;
    font-weight: 500;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    min-height: 48px;
    touch-action: manipulation;
  }

  .upgrade-btn::before, .game-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.1), 
      transparent);
    transition: left 0.6s ease;
  }

  .upgrade-btn:hover, .game-btn:hover {
    background: linear-gradient(135deg, 
      rgba(124, 77, 255, 0.2) 0%, 
      rgba(0, 229, 255, 0.1) 100%);
    border-color: rgba(0, 229, 255, 0.5);
    transform: translateY(-3px);
    box-shadow: 
      0 15px 30px rgba(0, 229, 255, 0.2),
      0 0 20px rgba(124, 77, 255, 0.1);
  }

  .upgrade-btn:hover::before, .game-btn:hover::before {
    left: 100%;
  }

  .upgrade-btn:active, .game-btn:active {
    transform: translateY(-1px);
  }

  #upgrade-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
    padding-bottom: 90px;
  }

  #game-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    padding-bottom: 90px;
  }

  #life-counter {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 12px;
    color: var(--primary-green);
    text-shadow: 0 0 20px var(--primary-green);
    letter-spacing: -0.5px;
  }

  #humans-counter, #animals-counter, #lps-counter {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 6px;
    color: var(--primary-blue);
    text-shadow: 0 0 10px var(--primary-blue);
  }

  #time-counter {
    font-size: 14px;
    margin-top: 12px;
    color: var(--warning);
    font-family: 'Space Mono', 'Ubuntu Mono', 'Liberation Mono', 'Courier New', monospace;
    font-weight: 400;
    text-shadow: 0 0 10px var(--warning);
  }

  .click-text {
    position: absolute;
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-green);
    pointer-events: none;
    z-index: 1000;
    will-change: transform, opacity;
    text-shadow: 0 0 15px var(--primary-green);
  }

  .life-particle {
    position: absolute;
    width: 24px;
    height: 24px;
    background: radial-gradient(circle, var(--primary-green) 0%, transparent 70%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1000;
    box-shadow: 
      0 0 15px var(--primary-green), 
      0 0 30px var(--primary-green),
      inset 0 0 10px rgba(255, 255, 255, 0.3);
    will-change: transform, opacity;
  }

  #offline-progress-notification {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--card-bg);
    backdrop-filter: blur(15px);
    color: var(--text-primary);
    padding: 20px 25px;
    border-radius: 20px;
    text-align: center;
    z-index: 1001;
    border: 1px solid var(--border-glow);
    box-shadow: 
      0 20px 40px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
    max-width: 90%;
  }

  #offline-progress-notification p {
    margin: 8px 0;
    font-weight: 500;
  }

  #offline-progress-notification p:first-child {
    font-size: 18px;
    font-weight: 600;
    color: var(--primary-blue);
  }

  h2 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-primary);
    text-align: center;
    letter-spacing: -0.3px;
  }

  #stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
    padding-bottom: 90px;
  }

  .stat-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 16px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    transition: all 0.3s ease;
  }

  .stat-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    border-color: var(--border-glow);
  }

  .stat-label {
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
    color: var(--text-secondary);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-item span:last-child {
    font-weight: 700;
    font-size: 18px;
    color: var(--primary-blue);
  }

  #vignette-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.5s ease;
    background: radial-gradient(circle at center, 
      transparent 40%, 
      rgba(0, 0, 0, 0.7) 100%);
  }

  #vignette-overlay.active {
    opacity: 1;
  }

  #game-info {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  #game-info p {
    margin: 8px 0;
    color: var(--text-secondary);
    font-size: 14px;
    font-family: 'Space Mono', 'Ubuntu Mono', 'Liberation Mono', 'Courier New', monospace;
  }

  #title-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, 
      #0a0a0f 0%, 
      #1a1a2e 25%, 
      #16213e 50%, 
      #0f3460 75%, 
      #0a0a0f 100%);
    opacity: 1;
    transition: opacity 1.5s ease, visibility 1.5s ease;
  }

  #title-screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  #title-screen-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="star" cx="50%" cy="50%"><stop offset="0%" stop-color="white" stop-opacity="1"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><circle cx="20" cy="30" r="0.5" fill="url(%23star)"/><circle cx="80" cy="20" r="0.3" fill="url(%23star)"/><circle cx="30" cy="70" r="0.4" fill="url(%23star)"/><circle cx="70" cy="80" r="0.6" fill="url(%23star)"/><circle cx="50" cy="50" r="0.2" fill="url(%23star)"/><circle cx="10" cy="60" r="0.3" fill="url(%23star)"/></svg>') repeat;
    animation: starfieldMove 60s linear infinite;
    opacity: 0.3;
  }

  @keyframes starfieldMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(-100px, -100px); }
  }

  #title-screen-content {
    text-align: center;
    z-index: 2;
    position: relative;
    max-width: 600px;
    padding: 40px;
  }

  #title-logo h1 {
    font-size: 4rem;
    font-weight: 700;
    margin: 0 0 20px 0;
    background: linear-gradient(45deg, 
      var(--primary-blue), 
      var(--primary-green), 
      var(--primary-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(0, 229, 255, 0.5);
    letter-spacing: -2px;
    animation: titleGlow 3s ease-in-out infinite alternate;
  }

  @keyframes titleGlow {
    0% { 
      filter: drop-shadow(0 0 20px rgba(0, 229, 255, 0.3));
      transform: scale(1);
    }
    100% { 
      filter: drop-shadow(0 0 40px rgba(0, 229, 255, 0.6));
      transform: scale(1.02);
    }
  }

  #title-logo p {
    font-size: 1.2rem;
    color: var(--text-secondary);
    margin: 0 0 40px 0;
    font-weight: 300;
    letter-spacing: 2px;
    text-transform: uppercase;
    opacity: 0.8;
  }

  .title-btn {
    background: linear-gradient(135deg, 
      rgba(0, 229, 255, 0.2) 0%, 
      rgba(124, 77, 255, 0.2) 100%);
    border: 2px solid var(--primary-blue);
    color: var(--text-primary);
    font-size: 1.3rem;
    font-weight: 600;
    padding: 20px 50px;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 20px 0;
  }

  .title-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.2), 
      transparent);
    transition: left 0.6s ease;
  }

  .title-btn:hover {
    background: linear-gradient(135deg, 
      rgba(0, 229, 255, 0.4) 0%, 
      rgba(124, 77, 255, 0.4) 100%);
    border-color: var(--primary-green);
    transform: translateY(-5px) scale(1.05);
    box-shadow: 
      0 20px 40px rgba(0, 229, 255, 0.3),
      0 0 50px rgba(0, 229, 255, 0.2);
  }

  .title-btn:hover::before {
    left: 100%;
  }

  .title-btn:active {
    transform: translateY(-2px) scale(1.02);
  }

  #title-credits {
    margin-top: 60px;
    opacity: 0.6;
  }

  #title-credits p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
    font-weight: 300;
    letter-spacing: 0.5px;
  }

  #title-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }

  .title-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: radial-gradient(circle, var(--primary-blue) 0%, transparent 70%);
    border-radius: 50%;
    animation: floatParticle 15s linear infinite;
    opacity: 0.7;
  }

  @keyframes floatParticle {
    0% {
      transform: translateY(100vh) translateX(0) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 0.7;
    }
    90% {
      opacity: 0.7;
    }
    100% {
      transform: translateY(-100px) translateX(100px) rotate(360deg);
      opacity: 0;
    }
  }

  @media (max-width: 768px) {
    #game-container {
      height: calc(100% - 70px);
    }
    
    #mobile-nav {
      height: 70px;
      padding: 0 15px;
    }
    
    .nav-btn {
      font-size: 11px;
      padding: 10px 6px;
      min-height: 50px;
    }
    
    #hud {
      max-width: 92%;
      padding: 16px 20px;
      top: 15px;
    }
    
    #life-counter {
      font-size: 28px;
    }
    
    #humans-counter, #animals-counter, #lps-counter {
      font-size: 15px;
    }
    
    #time-counter {
      font-size: 13px;
    }
    
    #upgrades, #sidebar, #stats-container {
      margin: 10px;
      padding: 20px;
    }
    
    h2 {
      font-size: 22px;
    }
    
    #upgrade-grid {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      padding-bottom: 80px;
    }
    
    #game-controls {
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      padding-bottom: 80px;
    }
    
    #stats-grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      padding-bottom: 80px;
    }
    
    #title-logo h1 {
      font-size: 2.5rem;
      letter-spacing: -1px;
    }

    #title-logo p {
      font-size: 1rem;
      letter-spacing: 1px;
    }

    .title-btn {
      font-size: 1.1rem;
      padding: 18px 40px;
    }

    #title-screen-content {
      padding: 20px;
    }
  }

  @media (max-width: 480px) {
    #upgrade-grid {
      grid-template-columns: 1fr 1fr;
    }
    
    #game-controls {
      grid-template-columns: 1fr;
    }
    
    #stats-grid {
      grid-template-columns: 1fr;
    }
    
    .nav-btn {
      font-size: 10px;
    }
    
    #title-logo h1 {
      font-size: 2rem;
    }

    .title-btn {
      font-size: 1rem;
      padding: 16px 35px;
    }
  }

  /* Scrollbar styling */
  .tab-pane::-webkit-scrollbar {
    width: 6px;
  }

  .tab-pane::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
  }

  .tab-pane::-webkit-scrollbar-thumb {
    background: var(--primary-blue);
    border-radius: 3px;
    opacity: 0.5;
  }

  .tab-pane::-webkit-scrollbar-thumb:hover {
    opacity: 0.8;
  }

  /* Loading animation */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .loading {
    animation: pulse 2s infinite;
  }

  /* Glow effects */
  @keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(0, 229, 255, 0.3); }
    50% { box-shadow: 0 0 30px rgba(0, 229, 255, 0.6); }
  }

  .glow-effect {
    animation: glow 3s infinite;
  }
  
  #loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, 
      #0a0a0f 0%, 
      #1a1a2e 25%, 
      #16213e 50%, 
      #0f3460 75%, 
      #0a0a0f 100%);
    opacity: 0;
    transition: opacity 1s ease;
  }

  #loading-screen.active {
    display: flex;
    opacity: 1;
  }

  #loading-screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  #loading-screen-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="loadingStar" cx="50%" cy="50%"><stop offset="0%" stop-color="white" stop-opacity="1"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><circle cx="15" cy="25" r="0.3" fill="url(%23loadingStar)"/><circle cx="85" cy="15" r="0.4" fill="url(%23loadingStar)"/><circle cx="25" cy="75" r="0.2" fill="url(%23loadingStar)"/><circle cx="75" cy="85" r="0.5" fill="url(%23loadingStar)"/><circle cx="50" cy="40" r="0.3" fill="url(%23loadingStar)"/><circle cx="20" cy="60" r="0.2" fill="url(%23loadingStar)"/></svg>') repeat;
    animation: loadingStarfieldMove 40s linear infinite;
    opacity: 0.4;
  }

  @keyframes loadingStarfieldMove {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(-100px, -100px) rotate(360deg); }
  }

  #loading-screen-content {
    text-align: center;
    z-index: 2;
    position: relative;
    max-width: 600px;
    padding: 40px;
  }

  #loading-logo h1 {
    font-size: 3rem;
    font-weight: 700;
    margin: 0 0 15px 0;
    background: linear-gradient(45deg, 
      var(--primary-blue), 
      var(--primary-green), 
      var(--primary-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -1px;
    animation: loadingGlow 2s ease-in-out infinite alternate;
  }

  #loading-logo p {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin: 0 0 40px 0;
    font-weight: 300;
    letter-spacing: 1px;
    text-transform: uppercase;
    opacity: 0.9;
  }

  @keyframes loadingGlow {
    0% { 
      filter: drop-shadow(0 0 15px rgba(0, 229, 255, 0.4));
    }
    100% { 
      filter: drop-shadow(0 0 25px rgba(0, 229, 255, 0.7));
    }
  }

  #loading-progress {
    margin: 30px 0;
  }

  #loading-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    border: 1px solid rgba(0, 229, 255, 0.3);
    box-shadow: 
      0 0 10px rgba(0, 229, 255, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  #loading-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, 
      var(--primary-blue) 0%, 
      var(--primary-green) 50%, 
      var(--primary-purple) 100%);
    border-radius: 3px;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 0 15px rgba(0, 229, 255, 0.6),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }

  #loading-fill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.4), 
      transparent);
    animation: loadingShimmer 2s infinite;
  }

  @keyframes loadingShimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  #loading-percentage {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-blue);
    margin-top: 15px;
    font-family: 'Space Mono', 'Ubuntu Mono', 'Liberation Mono', 'Courier New', monospace;
    text-shadow: 0 0 10px var(--primary-blue);
  }

  #loading-text {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-top: 25px;
    font-weight: 400;
    letter-spacing: 0.5px;
    opacity: 0.8;
    animation: loadingTextPulse 2s ease-in-out infinite;
  }

  @keyframes loadingTextPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  #loading-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
  }

  .loading-particle {
    position: absolute;
    width: 3px;
    height: 3px;
    background: radial-gradient(circle, var(--primary-green) 0%, transparent 70%);
    border-radius: 50%;
    animation: loadingFloatParticle 12s linear infinite;
    opacity: 0.8;
  }

  @keyframes loadingFloatParticle {
    0% {
      transform: translateY(100vh) translateX(0) rotate(0deg) scale(0);
      opacity: 0;
    }
    10% {
      opacity: 0.8;
      transform: scale(1);
    }
    90% {
      opacity: 0.8;
      transform: scale(1);
    }
    100% {
      transform: translateY(-100px) translateX(50px) rotate(360deg) scale(0);
      opacity: 0;
    }
  }

  @media (max-width: 768px) {
    #loading-logo h1 {
      font-size: 2.2rem;
      letter-spacing: -0.5px;
    }

    #loading-logo p {
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    #loading-screen-content {
      padding: 30px 20px;
    }

    #loading-bar {
      height: 6px;
    }

    #loading-percentage {
      font-size: 1.1rem;
    }

    #loading-text {
      font-size: 0.9rem;
    }
  }

  @media (max-width: 480px) {
    #loading-logo h1 {
      font-size: 1.8rem;
    }

    #loading-percentage {
      font-size: 1rem;
    }
  }

  /* Landscape orientation adjustments */
  @media screen and (orientation: landscape) and (max-height: 500px) {
    #hud {
      top: 10px;
      padding: 12px 20px;
    }
    
    #mobile-nav {
      height: 60px;
    }
    
    .nav-btn {
      min-height: 44px;
      font-size: 10px;
    }
    
    #game-container {
      height: calc(100% - 60px);
    }
  }

  /* Android Chrome address bar handling */
  @supports (-webkit-appearance: none) {
    body {
      height: -webkit-fill-available;
    }
  }

  /* Improved scrolling for Android */
  .tab-pane {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  /* Better focus handling for Android */
  .nav-btn:focus,
  .upgrade-btn:focus,
  .game-btn:focus {
    outline: 2px solid var(--primary-blue);
    outline-offset: 2px;
  }

  /* Android-specific animations */
  @media (prefers-reduced-motion: no-preference) {
    .upgrade-btn, .game-btn {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .upgrade-btn, .game-btn, .nav-btn {
      transition: none;
    }
    
    .click-text, .life-particle {
      animation: none;
    }
  }
</style>
</head>
<body>
<div id="mobile-nav">
  <button class="nav-btn active" data-tab="home">
    <div style="font-size: 20px; margin-bottom: 4px;">ğŸŒ</div>
    Home
  </button>
  <button class="nav-btn" data-tab="creativity">
    <div style="font-size: 20px; margin-bottom: 4px;">âš¡</div>
    Evolution
  </button>
  <button class="nav-btn" data-tab="stats">
    <div style="font-size: 20px; margin-bottom: 4px;">ğŸ“Š</div>
    Stats
  </button>
  <button class="nav-btn" data-tab="options">
    <div style="font-size: 20px; margin-bottom: 4px;">âš™ï¸</div>
    Settings
  </button>
</div>
<div id="tab-content">
  <div id="home-tab" class="tab-pane active">
    <div id="game-container">
      <div id="hud">
        <div id="life-counter">Life: 0</div>
        <div id="humans-counter">Humans: 0</div>
        <div id="animals-counter">Animals: 0</div>
        <div id="lps-counter">Life per second: 0</div>
        <div id="time-counter">Year 0, Day 0, 00:00:00</div>
      </div>
    </div>
  </div>
  <div id="creativity-tab" class="tab-pane">
    <div id="upgrades">
      <h2>ğŸ§¬ Evolution Lab</h2>
      <div id="upgrade-grid">
        <button class="upgrade-btn" id="planet-upgrade">Upgrade Planet (Cost: 10 Life)</button>
        <button class="upgrade-btn" id="human-upgrade">Create Humans (Cost: 100 Life)</button>
        <button class="upgrade-btn" id="animal-upgrade">Create Animals (Cost: 50 Life)</button>
        <button class="upgrade-btn" id="click-upgrade">Upgrade Click (Cost: 50 Life)</button>
        <button class="upgrade-btn" id="education-upgrade">Education System (Cost: 200 Life)</button>
        <button class="upgrade-btn" id="technology-upgrade">Technological Advancement (Cost: 500 Life)</button>
        <button class="upgrade-btn" id="ecosystem-upgrade">Enhance Ecosystem (Cost: 150 Life)</button>
        <button class="upgrade-btn" id="biodiversity-upgrade">Increase Biodiversity (Cost: 300 Life)</button>
        <button class="upgrade-btn" id="agriculture-upgrade">Develop Agriculture (Cost: 250 Life)</button>
        <button class="upgrade-btn" id="conservation-upgrade">Wildlife Conservation (Cost: 350 Life)</button>
      </div>
    </div>
  </div>
  <div id="stats-tab" class="tab-pane">
    <div id="stats-container">
      <h2>ğŸ“ˆ Planetary Statistics</h2>
      <div id="stats-grid">
        <div class="stat-item">
          <span class="stat-label" id="total-life-label">Total Life Produced:</span>
          <span id="total-life-stat">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label" id="total-clicks-label">Total Clicks:</span>
          <span id="total-clicks-stat">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label" id="planets-produced-label">Planets Produced:</span>
          <span id="planets-produced-stat">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label" id="humans-created-label">Humans Created:</span>
          <span id="humans-created-stat">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label" id="animals-created-label">Animals Created:</span>
          <span id="animals-created-stat">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label" id="time-played-label">Time Played:</span>
          <span id="time-played-stat">0 days, 00:00:00</span>
        </div>
      </div>
    </div>
  </div>
  <div id="options-tab" class="tab-pane">
    <div id="sidebar">
      <h2>âš™ï¸ Game Settings</h2>
      <div id="game-controls">
        <button class="game-btn" id="save-game">Save Game</button>
        <button class="game-btn" id="confirm-reset">Reset Progress</button>
        <button class="game-btn" id="toggle-sound">Sound Effects: On</button>
        <button class="game-btn" id="toggle-music">Music: On</button>
        <button class="game-btn" id="toggle-short-notation">Short Numbers: On</button>
        <button class="game-btn" id="toggle-fast-notes">Fast Notes: On</button>
        <button class="game-btn" id="toggle-vignette">Vignette Effect: Off</button>
        <button class="game-btn" id="toggle-haptic">Haptic Feedback: On</button>
        <button class="game-btn" id="language-selector">Language: ğŸ‡ºğŸ‡¸ English</button>
      </div>
      <div id="game-info">
        <p id="zoom-info">Zoom: Z (in) / O (out)</p>
        <p id="human-activity">Human Activity: Idle</p>
      </div>
    </div>
  </div>
</div>
<div id="vignette-overlay"></div>
<div id="title-screen">
  <div id="title-screen-background"></div>
  <div id="title-screen-content">
    <div id="title-logo">
      <h1>Planet Genesis</h1>
      <p>Advanced Idle Evolution Game</p>
    </div>
    <div id="title-particles"></div>
    <button id="start-game-btn" class="title-btn">Begin Evolution</button>
    <div id="title-credits">
      <p>Click to create life â€¢ Evolve your planet â€¢ Reach for the stars</p>
    </div>
  </div>
</div>
<div id="loading-screen">
  <div id="loading-screen-background"></div>
  <div id="loading-screen-content">
    <div id="loading-logo">
      <h1>Planet Genesis</h1>
      <p>Initializing Evolution Engine</p>
    </div>
    
    <div id="loading-progress">
      <div id="loading-bar">
        <div id="loading-fill"></div>
      </div>
      <div id="loading-percentage">0%</div>
    </div>
    
    <div id="loading-text">Preparing primordial conditions...</div>
    
    <div id="loading-particles"></div>
  </div>
</div>
<!-- Reset Confirmation Modal -->
<div id="reset-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10001; display: flex; align-items: center; justify-content: center;">
  <div style="background: var(--card-bg); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; margin: 20px; max-width: 400px; border: 1px solid var(--border-glow); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);">
    <h3 style="margin: 0 0 20px 0; color: var(--text-primary); font-size: 20px; text-align: center;">âš ï¸ Reset Game Progress</h3>
    <p style="margin: 0 0 25px 0; color: var(--text-secondary); text-align: center; line-height: 1.5;">Are you sure you want to reset all game progress? This action cannot be undone.</p>
    <div style="display: flex; gap: 15px; justify-content: center;">
      <button id="cancel-reset" style="background: var(--glass-bg); border: 1px solid var(--text-secondary); color: var(--text-secondary); padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 500; min-height: 48px; min-width: 80px;">Cancel</button>
      <button id="confirm-reset-final" style="background: linear-gradient(135deg, var(--danger), #ff5577); border: 1px solid var(--danger); color: white; padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 600; min-height: 48px; min-width: 80px;">Reset</button>
    </div>
  </div>
</div>
<script>
// Add device detection variables at the top
const isAndroid = /Android/i.test(navigator.userAgent);
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
let touchStartTime = 0;
let lastClickTime = 0;
let isProcessingClick = false;

let audioEnabled = true;
let musicEnabled = true;
let hapticEnabled = true;
let audioPlayer;
let musicPlayer;
let currentLanguage = 'en';

// Initialize haptic feedback support
function initializeHaptics() {
  if ('vibrate' in navigator) {
    window.hapticFeedback = (pattern) => {
      if (hapticEnabled) {
        navigator.vibrate(pattern);
      }
    };
  } else {
    window.hapticFeedback = () => {}; // Fallback for devices without vibration
  }
}

// Call haptic initialization
initializeHaptics();

// Language dictionary
const languages = {
  en: {
    name: 'English',
    flag: 'ğŸ‡ºğŸ‡¸',
    texts: {
      // Game title and meta
      gameTitle: 'Planet Genesis',
      gameSubtitle: 'Advanced Idle Evolution Game',
      beginEvolution: 'Begin Evolution',
      welcomeBack: 'Welcome Back, Creator!',
      offlineFor: 'Offline for',
      evolutionProgress: 'Evolution Progress:',
      
      // Navigation
      home: 'Home',
      evolution: 'Evolution',
      stats: 'Stats',
      settings: 'Settings',
      
      // Main counters
      life: 'Life',
      humans: 'Humans',
      animals: 'Animals',
      lifePerSecond: 'Life per second',
      year: 'Year',
      day: 'Day',
      
      // Evolution Lab
      evolutionLab: 'ğŸ§¬ Evolution Lab',
      upgradePlanet: 'Upgrade Planet',
      createHumans: 'Create Humans',
      createAnimals: 'Create Animals',
      upgradeClick: 'Upgrade Click',
      educationSystem: 'Education System',
      technologicalAdvancement: 'Technological Advancement',
      enhanceEcosystem: 'Enhance Ecosystem',
      increaseBiodiversity: 'Increase Biodiversity',
      developAgriculture: 'Develop Agriculture',
      wildlifeConservation: 'Wildlife Conservation',
      cost: 'Cost',
      
      // Stats
      planetaryStatistics: 'ğŸ“ˆ Planetary Statistics',
      totalLifeProduced: 'Total Life Produced:',
      totalClicks: 'Total Clicks:',
      planetsProduced: 'Planets Produced:',
      humansCreated: 'Humans Created:',
      animalsCreated: 'Animals Created:',
      timePlayed: 'Time Played:',
      days: 'days',
      
      // Settings
      gameSettings: 'âš™ï¸ Game Settings',
      saveGame: 'Save Game',
      resetGame: 'Reset Game',
      soundEffects: 'Sound Effects',
      music: 'Music',
      shortNumbers: 'Short Numbers',
      fastNotes: 'Fast Notes',
      vignetteEffect: 'Vignette Effect',
      hapticFeedback: 'Haptic Feedback',
      language: 'Language',
      on: 'On',
      off: 'Off',
      zoom: 'Zoom: Z (in) / O (out)',
      humanActivity: 'Human Activity: Idle',
      
      // Loading screen
      initializingEvolutionEngine: 'Initializing Evolution Engine',
      preparingPrimordialConditions: 'Preparing primordial conditions...',
      ignitingStellarFusion: 'Igniting stellar fusion...',
      formingPlanetarySystems: 'Forming planetary systems...',
      creatingAtmosphericLayers: 'Creating atmospheric layers...',
      seedingGeneticAlgorithms: 'Seeding genetic algorithms...',
      initializingEvolutionProtocols: 'Initializing evolution protocols...',
      calibratingLifeParameters: 'Calibrating life parameters...',
      loadingEcosystemTemplates: 'Loading ecosystem templates...',
      synchronizingTimeDilation: 'Synchronizing time dilation...',
      readyForGenesis: 'Ready for genesis...',
      
      // Other
      clickToCreateLife: 'Click to create life â€¢ Evolve your planet â€¢ Reach for the stars',
      resetConfirm: 'Are you sure you want to reset the game? All progress will be lost.',
      newHumans: 'New Humans',
      newAnimals: 'New Animals'
    }
  },
  is: {
    name: 'Ãslenska',
    flag: 'ğŸ‡®ğŸ‡¸',
    texts: {
      gameTitle: 'TilurÃ° PlÃ¡netu',
      gameSubtitle: 'HÃ¡Ã¾rÃ³aÃ°ur AÃ°gerÃ°arlaus ÃrÃ³unarleikur',
      beginEvolution: 'Byrja ÃrÃ³un',
      welcomeBack: 'Velkomin aftur, Skapari!',
      offlineFor: 'Ã“tengdur Ã­',
      evolutionProgress: 'ÃrÃ³unarframfarir:',
      
      home: 'Heim',
      evolution: 'ÃrÃ³un',
      stats: 'TÃ¶lfrÃ¦Ã°i',
      settings: 'Stillingar',
      
      life: 'LÃ­f',
      humans: 'Menn',
      animals: 'DÃ½r',
      lifePerSecond: 'LÃ­f Ã¡ sekÃºndu',
      year: 'Ãr',
      day: 'Dagur',
      
      evolutionLab: 'ğŸ§¬ ÃrÃ³unarfrÃ¦Ã°i',
      upgradePlanet: 'UppfÃ¦ra PlÃ¡netu',
      createHumans: 'Skapa Menn',
      createAnimals: 'Skapa DÃ½r',
      upgradeClick: 'UppfÃ¦ra Smell',
      educationSystem: 'Menntakerfi',
      technologicalAdvancement: 'TÃ¦kniframfarir',
      enhanceEcosystem: 'BÃ¦ta VistkerfiÃ°',
      increaseBiodiversity: 'Auka LÃ­ffrÃ¦Ã°ilega FjÃ¶lbreytni',
      developAgriculture: 'ÃrÃ³a LandbÃºnaÃ°',
      wildlifeConservation: 'NÃ¡ttÃºruvernd',
      cost: 'KostnaÃ°ur',
      
      planetaryStatistics: 'ğŸ“ˆ PlÃ¡netu TÃ¶lfrÃ¦Ã°i',
      totalLifeProduced: 'HeildarlÃ­f Framleitt:',
      totalClicks: 'Heildarsmellir:',
      planetsProduced: 'PlÃ¡netur Framleiddar:',
      humansCreated: 'Menn SkapaÃ°ir:',
      animalsCreated: 'DÃ½r SkÃ¶puÃ°:',
      timePlayed: 'TÃ­mi Leikinn:',
      days: 'dagar',
      
      gameSettings: 'âš™ï¸ Leikstillingar',
      saveGame: 'Lagre Leik',
      resetGame: 'Tilbakestill Leik',
      soundEffects: 'Ljudeffekter',
      music: 'Musikk',
      shortNumbers: 'Korte Tall',
      fastNotes: 'Hurtige Anteckningar',
      vignetteEffect: 'Vigneteffekt',
      hapticFeedback: 'Haptisk Tilbakemelding',
      language: 'SprÃ¥k',
      on: 'PÃ¥',
      off: 'Av',
      zoom: 'Zoom: Z (in) / O (ut)',
      humanActivity: 'Menneskelig Aktivitet: Inaktiv',
      
      initializingEvolutionEngine: 'Initialiserer Evolutionsmotor',
      preparingPrimordialConditions: 'Forbereder oprindelige forhold...',
      ignitingStellarFusion: 'TÃ¦nder stjernefusion...',
      formingPlanetarySystems: 'Danner planetsystemer...',
      creatingAtmosphericLayers: 'Skaper atmosfÃ¦riske lag...',
      seedingGeneticAlgorithms: 'SÃ¥r genetiske algoritmer...',
      initializingEvolutionProtocols: 'Initialiserer evolutionsprotokoller...',
      calibratingLifeParameters: 'Kalibrerer livsparametrar...',
      loadingEcosystemTemplates: 'IndlÃ¦ser Ã¸kosystemskabeloner...',
      synchronizingTimeDilation: 'Synkroniserer tidsudvidelse...',
      readyForGenesis: 'Klar for genesis...',
      
      clickToCreateLife: 'Smelltu til aÃ° skapa lÃ­f â€¢ ÃrÃ³aÃ°u plÃ¡netuna Ã¾Ã­na â€¢ NÃ¡Ã°u til stjarnanna',
      resetConfirm: 'Ertu viss um aÃ° Ã¾Ãº viljir endurstilla leikinn? All framfarir tapast.',
      newHumans: 'NÃ½ir Menn',
      newAnimals: 'NÃ½ DÃ½r'
    }
  },
  es: {
    name: 'EspaÃ±ol',
    flag: 'ğŸ‡ªğŸ‡¸',
    texts: {
      gameTitle: 'GÃ©nesis Planetario',
      gameSubtitle: 'Juego Avanzado de EvoluciÃ³n Inactiva',
      beginEvolution: 'Comenzar EvoluciÃ³n',
      welcomeBack: 'Â¡Bienvenido de vuelta, Creador!',
      offlineFor: 'Desconectado por',
      evolutionProgress: 'Progreso de EvoluciÃ³n:',
      
      home: 'Inicio',
      evolution: 'EvoluciÃ³n',
      stats: 'EstadÃ­sticas',
      settings: 'ConfiguraciÃ³n',
      
      life: 'Vida',
      humans: 'Humanos',
      animals: 'Animales',
      lifePerSecond: 'Vida por segundo',
      year: 'AÃ±o',
      day: 'DÃ­a',
      
      evolutionLab: 'ğŸ§¬ Laboratorio de EvoluciÃ³n',
      upgradePlanet: 'Mejorar Planeta',
      createHumans: 'Crear Humanos',
      createAnimals: 'Crear Animales',
      upgradeClick: 'Mejorar Clic',
      educationSystem: 'Sistema Educativo',
      technologicalAdvancement: 'Avance TecnolÃ³gico',
      enhanceEcosystem: 'Mejorar Ecosistema',
      increaseBiodiversity: 'Aumentar Biodiversidad',
      developAgriculture: 'Desarrollar Agricultura',
      wildlifeConservation: 'ConservaciÃ³n de Vida Silvestre',
      cost: 'Costo',
      
      planetaryStatistics: 'ğŸ“ˆ EstadÃ­sticas Planetarias',
      totalLifeProduced: 'Vida Total Producida:',
      totalClicks: 'Clics Totales:',
      planetsProduced: 'Planetas Producidos:',
      humansCreated: 'Humanos Creados:',
      animalsCreated: 'Animales Creados:',
      timePlayed: 'Tiempo Jugado:',
      days: 'dÃ­as',
      
      gameSettings: 'âš™ï¸ ConfiguraciÃ³n del Juego',
      saveGame: 'Guardar Juego',
      resetGame: 'Reiniciar Juego',
      soundEffects: 'Efectos de Sonido',
      music: 'MÃºsica',
      shortNumbers: 'NÃºmeros Cortos',
      fastNotes: 'Notas RÃ¡pidas',
      vignetteEffect: 'Efecto ViÃ±eta',
      hapticFeedback: 'RetroalimentaciÃ³n HÃ¡ptica',
      language: 'Idioma',
      on: 'Activado',
      off: 'Desactivado',
      zoom: 'Zoom: Z (acercar) / O (alejar)',
      humanActivity: 'Actividad Humana: Inactiva',
      
      initializingEvolutionEngine: 'Inicializando Motor de EvoluciÃ³n',
      preparingPrimordialConditions: 'Preparando condiciones primordiales...',
      ignitingStellarFusion: 'Encendiendo fusiÃ³n estelar...',
      formingPlanetarySystems: 'Formando sistemas planetarios...',
      creatingAtmosphericLayers: 'Creando capas atmosfÃ©ricas...',
      seedingGeneticAlgorithms: 'Sembrando algoritmos genÃ©ticos...',
      initializingEvolutionProtocols: 'Inicializando protocolos de evoluciÃ³n...',
      calibratingLifeParameters: 'Calibrando parÃ¡metros de vida...',
      loadingEcosystemTemplates: 'Cargando plantillas de ecosistemas...',
      synchronizingTimeDilation: 'Sincronizando dilataciÃ³n temporal...',
      readyForGenesis: 'Listo para gÃ©nesis...',
      
      clickToCreateLife: 'Haz clic para crear vida â€¢ Evoluciona tu planeta â€¢ Alcanza las estrellas',
      resetConfirm: 'Â¿EstÃ¡s seguro de que quieres reiniciar el juego? Se perderÃ¡ todo el progreso.',
      newHumans: 'Nuevos Humanos',
      newAnimals: 'Nuevos Animales'
    }
  },
  zh: {
    name: 'ä¸­æ–‡',
    flag: 'ğŸ‡¨ğŸ‡³',
    texts: {
      gameTitle: 'æ˜Ÿçƒèµ·æº',
      gameSubtitle: 'é«˜çº§æ”¾ç½®è¿›åŒ–æ¸¸æˆ',
      beginEvolution: 'å¼€å§‹è¿›åŒ–',
      welcomeBack: 'æ¬¢è¿å›æ¥ï¼Œåˆ›é€ è€…ï¼',
      offlineFor: 'ç¦»çº¿æ—¶é—´',
      evolutionProgress: 'è¿›åŒ–è¿›åº¦ï¼š',
      
      home: 'ä¸»é¡µ',
      evolution: 'è¿›åŒ–',
      stats: 'ç»Ÿè®¡',
      settings: 'è®¾ç½®',
      
      life: 'ç”Ÿå‘½',
      humans: 'äººç±»',
      animals: 'åŠ¨ç‰©',
      lifePerSecond: 'æ¯ç§’ç”Ÿå‘½',
      year: 'å¹´',
      day: 'æ—¥',
      
      evolutionLab: 'ğŸ§¬ è¿›åŒ–å®éªŒå®¤',
      upgradePlanet: 'å‡çº§æ˜Ÿçƒ',
      createHumans: 'åˆ›é€ äººç±»',
      createAnimals: 'åˆ›é€ åŠ¨ç‰©',
      upgradeClick: 'å‡çº§ç‚¹å‡»',
      educationSystem: 'æ•™è‚²ç³»ç»Ÿ',
      technologicalAdvancement: 'æŠ€æœ¯è¿›æ­¥',
      enhanceEcosystem: 'å¢å¼ºç”Ÿæ€ç³»ç»Ÿ',
      increaseBiodiversity: 'å¢åŠ ç”Ÿç‰©å¤šæ ·æ€§',
      developAgriculture: 'å‘å±•å†œä¸š',
      wildlifeConservation: 'é‡ç”ŸåŠ¨ç‰©ä¿æŠ¤',
      cost: 'è´¹ç”¨',
      
      planetaryStatistics: 'ğŸ“ˆ æ˜Ÿçƒç»Ÿè®¡',
      totalLifeProduced: 'æ€»ç”Ÿå‘½äº§é‡ï¼š',
      totalClicks: 'æ€»ç‚¹å‡»æ•°ï¼š',
      planetsProduced: 'æ˜Ÿçƒäº§é‡ï¼š',
      humansCreated: 'åˆ›é€ çš„äººç±»ï¼š',
      animalsCreated: 'åˆ›é€ çš„åŠ¨ç‰©ï¼š',
      timePlayed: 'æ¸¸æˆæ—¶é—´ï¼š',
      days: 'å¤©',
      
      gameSettings: 'âš™ï¸ æ¸¸æˆè®¾ç½®',
      saveGame: 'ä¿å­˜æ¸¸æˆ',
      resetGame: 'é‡ç½®æ¸¸æˆ',
      soundEffects: 'éŸ³æ•ˆ',
      music: 'éŸ³ä¹',
      shortNumbers: 'ç®€çŸ­æ•°å­—',
      fastNotes: 'å¿«é€Ÿè®°å½•',
      vignetteEffect: 'æš—è§’æ•ˆæœ',
      hapticFeedback: 'è§¦è§‰åé¦ˆ',
      language: 'è¯­è¨€',
      on: 'å¼€',
      off: 'å…³',
      zoom: 'ç¼©æ”¾ï¼šZï¼ˆæ”¾å¤§ï¼‰/ Oï¼ˆç¼©å°ï¼‰',
      humanActivity: 'äººç±»æ´»åŠ¨ï¼šç©ºé—²',
      
      initializingEvolutionEngine: 'åˆå§‹åŒ–è¿›åŒ–å¼•æ“',
      preparingPrimordialConditions: 'å‡†å¤‡åŸå§‹æ¡ä»¶...',
      ignitingStellarFusion: 'ç‚¹ç‡ƒæ’æ˜Ÿèšå˜...',
      formingPlanetarySystems: 'å½¢æˆè¡Œæ˜Ÿç³»ç»Ÿ...',
      creatingAtmosphericLayers: 'åˆ›å»ºå¤§æ°”å±‚...',
      seedingGeneticAlgorithms: 'æ’­ç§é—ä¼ ç®—æ³•...',
      initializingEvolutionProtocols: 'åˆå§‹åŒ–è¿›åŒ–åè®®...',
      calibratingLifeParameters: 'æ ¡å‡†ç”Ÿå‘½å‚æ•°...',
      loadingEcosystemTemplates: 'åŠ è½½ç”Ÿæ€ç³»ç»Ÿæ¨¡æ¿...',
      synchronizingTimeDilation: 'åŒæ­¥æ—¶é—´è†¨èƒ€...',
      readyForGenesis: 'å‡†å¤‡åˆ›ä¸–...',
      
      clickToCreateLife: 'ç‚¹å‡»åˆ›é€ ç”Ÿå‘½ â€¢ è¿›åŒ–ä½ çš„æ˜Ÿçƒ â€¢ è§¦åŠæ˜Ÿè¾°',
      resetConfirm: 'ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¸¢å¤±ã€‚',
      newHumans: 'æ–°äººç±»',
      newAnimals: 'æ–°åŠ¨ç‰©'
    }
  },
  he: {
    name: '×¢×‘×¨×™×ª',
    flag: 'ğŸ‡®ğŸ‡±',
    texts: {
      gameTitle: '×‘×¨××©×™×ª ×›×•×›×‘×™',
      gameSubtitle: '××©×—×§ ××‘×•×œ×•×¦×™×” ××ª×§×“×',
      beginEvolution: '×”×ª×—×œ ××‘×•×œ×•×¦×™×”',
      welcomeBack: '×‘×¨×•×š ×©×•×‘×š, ×™×•×¦×¨!',
      offlineFor: '×œ× ××—×•×‘×¨ ×‘××©×š',
      evolutionProgress: '×”×ª×§×“××•×ª ××‘×•×œ×•×¦×™×”:',
      
      home: '×‘×™×ª',
      evolution: '××‘×•×œ×•×¦×™×”',
      stats: '×¡×˜×˜×™×¡×˜×™×§×•×ª',
      settings: '×”×’×“×¨×•×ª',
      
      life: '×—×™×™×',
      humans: '×‘× ×™ ××“×',
      animals: '×‘×¢×œ×™ ×—×™×™×',
      lifePerSecond: '×—×™×™× ×œ×©× ×™×™×”',
      year: '×©× ×”',
      day: '×™×•×',
      
      evolutionLab: 'ğŸ§¬ ××¢×‘×“×ª ××‘×•×œ×•×¦×™×”',
      upgradePlanet: '×©×“×¨×’ ×›×•×›×‘',
      createHumans: '×¦×•×¨ ×‘× ×™ ××“×',
      createAnimals: '×¦×•×¨ ×‘×¢×œ×™ ×—×™×™×',
      upgradeClick: '×©×“×¨×’ ×œ×—×™×¦×”',
      educationSystem: '××¢×¨×›×ª ×—×™× ×•×š',
      technologicalAdvancement: '×”×ª×§×“××•×ª ×˜×›× ×•×œ×•×’×™×ª',
      enhanceEcosystem: '×©×¤×¨ ××¢×¨×›×ª ××§×•×œ×•×’×™×ª',
      increaseBiodiversity: '×”×’×“×œ ××’×•×•×Ÿ ×‘×™×•×œ×•×’×™',
      developAgriculture: '×¤×ª×— ×—×§×œ××•×ª',
      wildlifeConservation: '×©×™××•×¨ ×—×™×•×ª ×‘×¨',
      cost: '×¢×œ×•×ª',
      
      planetaryStatistics: 'ğŸ“ˆ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×•×›×‘×™×•×ª',
      totalLifeProduced: '×¡×š ×”×—×™×™× ×©×™×•×¦×¨×•:',
      totalClicks: '×¡×š ×”×œ×—×™×¦×•×ª:',
      planetsProduced: '×›×•×›×‘×™× ×©×™×•×¦×¨×•:',
      humansCreated: '×‘× ×™ ××“× ×©× ×•×¦×¨×•:',
      animalsCreated: '×‘×¢×œ×™ ×—×™×™× ×©× ×•×¦×¨×•:',
      timePlayed: '×–××Ÿ ××©×—×§:',
      days: '×™××™×',
      
      gameSettings: 'âš™ï¸ ×”×’×“×¨×•×ª ××©×—×§',
      saveGame: '×©××•×¨ ××©×—×§',
      resetGame: '××¤×¡ ××©×—×§',
      soundEffects: '××¤×§×˜×™ ×§×•×œ',
      music: '××•×–×™×§×”',
      shortNumbers: '××¡×¤×¨×™× ×§×¦×¨×™×',
      fastNotes: '×”×¢×¨×•×ª ××”×™×¨×•×ª',
      vignetteEffect: '××¤×§×˜ ×•×™× ×™×™×˜',
      hapticFeedback: '××©×•×‘ ×”×¤×˜×™',
      language: '×©×¤×”',
      on: '×¤×•×¢×œ',
      off: '×›×‘×•×™',
      zoom: 'Zoom: Z (in) / O (ut)',
      humanActivity: '×¤×¢×™×œ×•×ª ×× ×•×©×™×ª: ×—×¡×¨ ×¤×¢×™×œ×•×ª',
      
      initializingEvolutionEngine: '×××ª×—×œ ×× ×•×¢ ××‘×•×œ×•×¦×™×”',
      preparingPrimordialConditions: '××›×™×Ÿ ×ª× ××™× ×¨××©×•× ×™×™×...',
      ignitingStellarFusion: '××¦×™×“ ×”×™×ª×•×š ×”×›×•×›×‘×™...',
      formingPlanetarySystems: '×™×•×¦×¨ ××¢×¨×›×•×ª ×›×•×›×‘×™×•×ª...',
      creatingAtmosphericLayers: '×™×•×¦×¨ ×©×›×‘×•×ª ××˜××•×¡×¤×¨×™×•×ª...',
      seedingGeneticAlgorithms: '×–×•×¨×¢ ××œ×’×•×¨×™×ª××™× ×’× ×˜×™×™×...',
      initializingEvolutionProtocols: '×××ª×—×œ ×¤×¨×•×˜×•×§×•×œ×™ ××‘×•×œ×•×¦×™×”...',
      calibratingLifeParameters: '××›×™×™×œ ×¤×¨××˜×¨×™ ×—×™×™×...',
      loadingEcosystemTemplates: '×˜×•×¢×Ÿ ×ª×‘× ×™×•×ª ××¢×¨×›×•×ª ××§×•×œ×•×’×™×•×ª...',
      synchronizingTimeDilation: '××¡× ×›×¨×Ÿ ×”×ª×¨×—×‘×•×ª ×–××Ÿ...',
      readyForGenesis: '××•×›×Ÿ ×œ×‘×¨××©×™×ª...',
      
      clickToCreateLife: '×œ×—×¥ ×›×“×™ ×œ×™×¦×•×¨ ×—×™×™× â€¢ ×¤×ª×— ××ª ×”×›×•×›×‘ ×©×œ×š â€¢ ×”×’×¢ ×œ×›×•×›×‘×™×',
      resetConfirm: '×”×× ××ª×” ×‘×˜×•×— ×©××ª×” ×¨×•×¦×” ×œ××¤×¡ ××ª ×”××©×—×§? ×›×œ ×”×”×ª×§×“××•×ª ×ª××‘×“.',
      newHumans: '×‘× ×™ ××“× ×—×“×©×™×',
      newAnimals: '×‘×¢×œ×™ ×—×™×™× ×—×“×©×™×'
    }
  },
  no: {
    name: 'Norsk',
    flag: 'ğŸ‡³ğŸ‡´',
    texts: {
      gameTitle: 'Planet Genesis',
      gameSubtitle: 'Avansert Idle Evolusjonsspill',
      beginEvolution: 'Begynn Evolusjon',
      welcomeBack: 'Velkommen tilbake, Skaper!',
      offlineFor: 'Offline i',
      evolutionProgress: 'Evolutionsfremgang:',
      
      home: 'Hjem',
      evolution: 'Evolusjon',
      stats: 'Statistikk',
      settings: 'Innstillinger',
      
      life: 'Liv',
      humans: 'Mennesker',
      animals: 'Dyr',
      lifePerSecond: 'Liv per sekund',
      year: 'Ã…r',
      day: 'Dag',
      
      evolutionLab: 'ğŸ§¬ Evolutionslaboratorium',
      upgradePlanet: 'Oppgrader Planet',
      createHumans: 'Skab Mennesker',
      createAnimals: 'Skab Dyr',
      upgradeClick: 'Oppgrader Klikk',
      educationSystem: 'Uddannelsessystem',
      technologicalAdvancement: 'Teknologisk Fremgang',
      enhanceEcosystem: 'Forbedre Ã˜kosystem',
      increaseBiodiversity: 'Ã˜k Biologisk Mangfold',
      developAgriculture: 'Utvikle Landbruk',
      wildlifeConservation: 'Naturvern',
      cost: 'Kostnad',
      
      planetaryStatistics: 'ğŸ“ˆ PlanetÃ¦r Statistik',
      totalLifeProduced: 'Totalt Liv Produceret:',
      totalClicks: 'Totala Klikk:',
      planetsProduced: 'Planeter Producerede:',
      humansCreated: 'Mennesker Skapet:',
      animalsCreated: 'Djur Skapet:',
      timePlayed: 'Tid Spilt:',
      days: 'dager',
      
      gameSettings: 'âš™ï¸ Spillinnstillinger',
      saveGame: 'Lagre Spil',
      resetGame: 'Tilbakestill Spil',
      soundEffects: 'Lydeffekter',
      music: 'Musikk',
      shortNumbers: 'Korte Tall',
      fastNotes: 'Hurtige Anteckningar',
      vignetteEffect: 'Vigneteffekt',
      hapticFeedback: 'Haptisk Tilbakemelding',
      language: 'SprÃ¥k',
      on: 'PÃ¥',
      off: 'Av',
      zoom: 'Zoom: Z (in) / O (ut)',
      humanActivity: 'Menneskelig Aktivitet: Inaktiv',
      
      initializingEvolutionEngine: 'Initialiserer Evolutionsmotor',
      preparingPrimordialConditions: 'Forbereder opprinnelige forhold...',
      ignitingStellarFusion: 'TÃ¦nder stjernefusion...',
      formingPlanetarySystems: 'Danner planetsystemer...',
      creatingAtmosphericLayers: 'Skaper atmosfÃ¦riske lag...',
      seedingGeneticAlgorithms: 'SÃ¥r genetiske algoritmer...',
      initializingEvolutionProtocols: 'Initialiserer evolutionsprotokoller...',
      calibratingLifeParameters: 'Kalibrerer livsparametrar...',
      loadingEcosystemTemplates: 'IndlÃ¦ser Ã¸kosystemskabeloner...',
      synchronizingTimeDilation: 'Synkroniserer tidsudvidelse...',
      readyForGenesis: 'Klar for genesis...',
      
      clickToCreateLife: 'Klikk for at skabe liv â€¢ Utvikl din planet â€¢ NÃ¥ stjernene',
      resetConfirm: 'Er du sikker pÃ¥ at du vil tilbakestille spillet? Al fremsteg kommer Ã¥ forsvinne.',
      newHumans: 'Nye Mennesker',
      newAnimals: 'Nye Dyr'
    }
  },
  da: {
    name: 'Dansk',
    flag: 'ğŸ‡©ğŸ‡°',
    texts: {
      gameTitle: 'Planet Genesis',
      gameSubtitle: 'Avanceret Idle Evolutionsspil',
      beginEvolution: 'Begynd Evolution',
      welcomeBack: 'Velkommen tilbage, Skaber!',
      offlineFor: 'Offline i',
      evolutionProgress: 'Evolutionsfremsteg:',
      
      home: 'Hjem',
      evolution: 'Evolution',
      stats: 'Statistikker',
      settings: 'Indstillinger',
      
      life: 'Liv',
      humans: 'Mennesker',
      animals: 'Djur',
      lifePerSecond: 'Liv per sekund',
      year: 'Ã…r',
      day: 'Dag',
      
      evolutionLab: 'ğŸ§¬ Evolutionslaboratorium',
      upgradePlanet: 'Opgrader Planet',
      createHumans: 'Skab Mennesker',
      createAnimals: 'Skab Dyr',
      upgradeClick: 'Opgrader Klik',
      educationSystem: 'Uddannelsessystem',
      technologicalAdvancement: 'Teknologisk Fremgang',
      enhanceEcosystem: 'Forbedre Ã˜kosystem',
      increaseBiodiversity: 'ForÃ¸g Biodiversitet',
      developAgriculture: 'Udvikle Landbrug',
      wildlifeConservation: 'Naturbevarelse',
      cost: 'Omkostning',
      
      planetaryStatistics: 'ğŸ“ˆ PlanetÃ¦r Statistik',
      totalLifeProduced: 'Samlet Liv Produceret:',
      totalClicks: 'Samlede Klik:',
      planetsProduced: 'Planeter Producerede:',
      humansCreated: 'Mennesker Skabt:',
      animalsCreated: 'Djur Skabt:',
      timePlayed: 'Tid Spillet:',
      days: 'dage',
      
      gameSettings: 'âš™ï¸ Spilindstillinger',
      saveGame: 'Gem Spil',
      resetGame: 'Nulstil Spil',
      soundEffects: 'Ljudeffekter',
      music: 'Musik',
      shortNumbers: 'Korte Tal',
      fastNotes: 'Hurtige Anteckningar',
      vignetteEffect: 'Vigneteffekt',
      hapticFeedback: 'Haptisk Feedback',
      language: 'Sprog',
      on: 'Til',
      off: 'Fra',
      zoom: 'Zoom: Z (ind) / O (ud)',
      humanActivity: 'Menneskelig Aktivitet: Inaktiv',
      
      initializingEvolutionEngine: 'Initialiserer Evolutionsmotor',
      preparingPrimordialConditions: 'Forbereder oprindelige forhold...',
      ignitingStellarFusion: 'TÃ¦nder stjernefusion...',
      formingPlanetarySystems: 'Danner planetsystemer...',
      creatingAtmosphericLayers: 'Skaber atmosfÃ¦riska lager...',
      seedingGeneticAlgorithms: 'SÃ¥r genetiske algoritmer...',
      initializingEvolutionProtocols: 'Initialiserer evolutionsprotokoller...',
      calibratingLifeParameters: 'Kalibrerer livsparametrar...',
      loadingEcosystemTemplates: 'IndlÃ¦ser Ã¸kosystemskabeloner...',
      synchronizingTimeDilation: 'Synkroniserer tidsudvidelse...',
      readyForGenesis: 'Klar til genesis...',
      
      clickToCreateLife: 'Klikk for at skabe liv â€¢ Utvikl din planet â€¢ NÃ¥ stjernene',
      resetConfirm: 'Er du sikker pÃ¥, at du vil nulstille spillet? Al fremsteg kommer Ã¥ forsvinne.',
      newHumans: 'Nye Mennesker',
      newAnimals: 'Nye Dyr'
    }
  },
  sv: {
    name: 'Svenska',
    flag: 'ğŸ‡¸ğŸ‡ª',
    texts: {
      gameTitle: 'Planet Genesis',
      gameSubtitle: 'Avancerat Idle Evolutionsspel',
      beginEvolution: 'BÃ¶rja Evolution',
      welcomeBack: 'VÃ¤lkommen tillbaka, Skapare!',
      offlineFor: 'Offline i',
      evolutionProgress: 'Evolutionsframsteg:',
      
      home: 'Hem',
      evolution: 'Evolution',
      stats: 'Statistik',
      settings: 'InstÃ¤llningar',
      
      life: 'Liv',
      humans: 'MÃ¤nniskor',
      animals: 'Djur',
      lifePerSecond: 'Liv per sekund',
      year: 'Ã…r',
      day: 'Dag',
      
      evolutionLab: 'ğŸ§¬ Evolutionslaboratorium',
      upgradePlanet: 'Uppgradera Planet',
      createHumans: 'Skapa MÃ¤nniskor',
      createAnimals: 'Skapa Djur',
      upgradeClick: 'Uppgradera Klick',
      educationSystem: 'Utbildningssystem',
      technologicalAdvancement: 'Teknologisk Utveckling',
      enhanceEcosystem: 'FÃ¶rbÃ¤ttra Ekosystem',
      increaseBiodiversity: 'Ã–ka Biologisk MÃ¥ngfald',
      developAgriculture: 'Utveckla Jordbruk',
      wildlifeConservation: 'NaturvÃ¥rd',
      cost: 'Kostnad',
      
      planetaryStatistics: 'ğŸ“ˆ PlanetÃ¤r Statistik',
      totalLifeProduced: 'Totalt Liv Producerat:',
      totalClicks: 'Totala Klick:',
      planetsProduced: 'Planeter Producerade:',
      humansCreated: 'MÃ¤nniskor Skapade:',
      animalsCreated: 'Djur Skapade:',
      timePlayed: 'Tid Spelad:',
      days: 'dagar',
      
      gameSettings: 'âš™ï¸ SpelinstÃ¤llningar',
      saveGame: 'Spara Spel',
      resetGame: 'Ã…terstÃ¤ll Spel',
      soundEffects: 'Ljudeffekter',
      music: 'Musik',
      shortNumbers: 'Korta Siffror',
      fastNotes: 'Snabba Anteckningar',
      vignetteEffect: 'Vinjetteffekt',
      hapticFeedback: 'Haptisk Ã…terkoppling',
      language: 'SprÃ¥k',
      on: 'PÃ¥',
      off: 'Av',
      zoom: 'Zoom: Z (in) / O (ut)',
      humanActivity: 'MÃ¤nsklig Aktivitet: Inaktiv',
      
      initializingEvolutionEngine: 'Initierar Evolutionsmotor',
      preparingPrimordialConditions: 'FÃ¶rbereder ursprungliga fÃ¶rhÃ¥llanden...',
      ignitingStellarFusion: 'TÃ¤nder stjÃ¤rnfusion...',
      formingPlanetarySystems: 'Bildar planetsystem...',
      creatingAtmosphericLayers: 'Skapar atmosfÃ¤riska lager...',
      seedingGeneticAlgorithms: 'SÃ¥r genetiska algoritmer...',
      initializingEvolutionProtocols: 'Initierar evolutionsprotokoll...',
      calibratingLifeParameters: 'Kalibrerar livsparametrar...',
      loadingEcosystemTemplates: 'Laddar ekosystemmallar...',
      synchronizingTimeDilation: 'Synkroniserar tidsutvidgning...',
      readyForGenesis: 'Redo fÃ¶r genesis...',
      
      clickToCreateLife: 'Klicka fÃ¶r att skapa liv â€¢ Utveckla din planet â€¢ NÃ¥ stjÃ¤rnorna',
      resetConfirm: 'Ã„r du sÃ¤ker pÃ¥ att du vill Ã¥terstÃ¤lla spelet? All framsteg kommer att fÃ¶rloras.',
      newHumans: 'Nya MÃ¤nniskor',
      newAnimals: 'Nya Djur'
    }
  }
};

function getText(key) {
  return languages[currentLanguage]?.texts[key] || languages.en.texts[key] || key;
}

function updateLanguage() {
  // Update title screen
  const titleH1 = document.querySelector('#title-logo h1');
  const titleP = document.querySelector('#title-logo p');
  const startBtn = document.getElementById('start-game-btn');
  const titleCredits = document.querySelector('#title-credits p');
  
  if (titleH1) titleH1.textContent = getText('gameTitle');
  if (titleP) titleP.textContent = getText('gameSubtitle');
  if (startBtn) startBtn.textContent = getText('beginEvolution');
  if (titleCredits) titleCredits.textContent = getText('clickToCreateLife');

  // Update loading screen
  const loadingH1 = document.querySelector('#loading-logo h1');
  const loadingP = document.querySelector('#loading-logo p');
  
  if (loadingH1) loadingH1.textContent = getText('gameTitle');
  if (loadingP) loadingP.textContent = getText('initializingEvolutionEngine');

  // Update navigation
  const navButtons = document.querySelectorAll('.nav-btn');
  const navTexts = ['home', 'evolution', 'stats', 'settings'];
  navButtons.forEach((btn, index) => {
    const textNode = btn.childNodes[1];
    if (textNode && textNode.nodeType === Node.TEXT_NODE) {
      textNode.textContent = getText(navTexts[index]);
    }
  });

  // Update main counters
  updateCounters();

  // Update headers
  const evolutionHeader = document.querySelector('#upgrades h2');
  const statsHeader = document.querySelector('#stats-container h2');
  const settingsHeader = document.querySelector('#sidebar h2');
  
  if (evolutionHeader) evolutionHeader.textContent = getText('evolutionLab');
  if (statsHeader) statsHeader.textContent = getText('planetaryStatistics');
  if (settingsHeader) settingsHeader.textContent = getText('gameSettings');

  // Update upgrade buttons
  updateAllUpgradeButtonTexts();

  // Update stats labels
  const statLabels = document.querySelectorAll('.stat-label');
  const statKeys = ['totalLifeProduced', 'totalClicks', 'planetsProduced', 'humansCreated', 'animalsCreated', 'timePlayed'];
  statLabels.forEach((label, index) => {
    if (statKeys[index]) {
      label.textContent = getText(statKeys[index]);
    }
  });

  // Update game controls
  const gameButtons = document.querySelectorAll('.game-btn');
  gameButtons.forEach(btn => {
    const id = btn.id;
    if (id === 'save-game') btn.textContent = getText('saveGame');
    else if (id === 'confirm-reset') btn.textContent = getText('resetGame');
    else if (id === 'toggle-sound') {
      btn.textContent = `${getText('soundEffects')}: ${audioEnabled ? getText('on') : getText('off')}`;
    }
    else if (id === 'toggle-music') {
      btn.textContent = `${getText('music')}: ${musicEnabled ? getText('on') : getText('off')}`;
    }
    else if (id === 'toggle-short-notation') {
      const isOn = btn.textContent.includes('On') || btn.textContent.includes('Auf') || btn.textContent.includes('Ã');
      btn.textContent = `${getText('shortNumbers')}: ${isOn ? getText('on') : getText('off')}`;
    }
    else if (id === 'toggle-fast-notes') {
      const isOn = btn.textContent.includes('On') || btn.textContent.includes('Auf') || btn.textContent.includes('Ã');
      btn.textContent = `${getText('fastNotes')}: ${isOn ? getText('on') : getText('off')}`;
    }
    else if (id === 'toggle-vignette') {
      const isOn = btn.textContent.includes('On') || btn.textContent.includes('Auf') || btn.textContent.includes('Ã');
      btn.textContent = `${getText('vignetteEffect')}: ${isOn ? getText('on') : getText('off')}`;
    }
    else if (id === 'toggle-haptic') {
      btn.textContent = `${getText('hapticFeedback')}: ${hapticEnabled ? getText('on') : getText('off')}`;
    }
    else if (id === 'language-selector') {
      btn.innerHTML = `${getText('language')}: ${languages[currentLanguage].flag} ${languages[currentLanguage].name}`;
    }
  });

  // Update game info
  const zoomInfo = document.getElementById('zoom-info');
  const humanActivity = document.getElementById('human-activity');
  
  if (zoomInfo) zoomInfo.textContent = getText('zoom');
  if (humanActivity) humanActivity.textContent = getText('humanActivity');

  // Update document title
  document.title = `${getText('gameTitle')} - ${getText('gameSubtitle')}`;
}

function initializeGame() {
  loadGame();
  initMobileTabs();
  updateStats();
  autosave();
  autoload();
  initializeAudio();
  initializeTitleScreen();
  
  // Add enhanced visual effects
  initializeParticleSystem();
  startGlowAnimations();
  updateLanguage();
  
  // Android-specific initializations
  if (isAndroid) {
    initializeAndroidOptimizations();
  }
}

function initializeAndroidOptimizations() {
  // Prevent double-tap zoom on Android
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function (event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, false);

  // Optimize touch handling for Android
  document.addEventListener('touchstart', function(e) {
    touchStartTime = e.timeStamp;
  }, { passive: true });

  // Improve scroll performance
  const tabPanes = document.querySelectorAll('.tab-pane');
  tabPanes.forEach(pane => {
    pane.style.transform = 'translateZ(0)';
    pane.style.willChange = 'scroll-position';
  });

  // Android-specific renderer optimizations
  if (renderer) {
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = false; // Disable shadows on low-end Android devices
  }

  // Reduce particle count on Android for better performance
  if (scene) {
    scene.traverse((child) => {
      if (child.material && child.material.transparent) {
        child.material.alphaTest = 0.1;
      }
    });
  }

  // Optimize memory usage
  setInterval(() => {
    if (renderer) {
      renderer.info.memory.geometries = Math.min(renderer.info.memory.geometries, 50);
      renderer.info.memory.textures = Math.min(renderer.info.memory.textures, 20);
    }
  }, 30000);

  console.log('Android optimizations initialized');
}

function initializeTitleScreen() {
  const titleScreen = document.getElementById('title-screen');
  const startBtn = document.getElementById('start-game-btn');
  
  // Create floating particles
  createTitleParticles();
  
  // Start button click handler
  startBtn.addEventListener('click', () => {
    // Play click sound
    playClickSound();
    
    // Add haptic feedback
    if (window.hapticFeedback) {
      window.hapticFeedback([30]);
    }
    
    // Show loading screen
    showLoadingScreen();
    
    // Fade out title screen
    gsap.to(titleScreen, {
      opacity: 0,
      duration: 1,
      ease: 'power2.inOut',
      onComplete: () => {
        titleScreen.classList.add('hidden');
      }
    });
  });
}

function showLoadingScreen() {
  const loadingScreen = document.getElementById('loading-screen');
  const loadingFill = document.getElementById('loading-fill');
  const loadingPercentage = document.getElementById('loading-percentage');
  const loadingText = document.getElementById('loading-text');
  
  // Show loading screen
  loadingScreen.classList.add('active');
  
  // Create loading particles
  createLoadingParticles();
  
  // Loading messages with translations
  const loadingMessages = [
    getText('preparingPrimordialConditions'),
    getText('ignitingStellarFusion'),
    getText('formingPlanetarySystems'),
    getText('creatingAtmosphericLayers'),
    getText('seedingGeneticAlgorithms'),
    getText('initializingEvolutionProtocols'),
    getText('calibratingLifeParameters'),
    getText('loadingEcosystemTemplates'),
    getText('synchronizingTimeDilation'),
    getText('readyForGenesis')
  ];
  
  let progress = 0;
  let messageIndex = 0;
  
  const loadingInterval = setInterval(() => {
    progress += Math.random() * 15 + 5; // Random progress increment
    
    if (progress > 100) {
      progress = 100;
    }
    
    // Update progress bar and percentage
    loadingFill.style.width = progress + '%';
    loadingPercentage.textContent = Math.floor(progress) + '%';
    
    // Update loading message
    if (messageIndex < loadingMessages.length - 1 && progress > (messageIndex + 1) * 10) {
      messageIndex++;
      loadingText.textContent = loadingMessages[messageIndex];
    }
    
    // Complete loading
    if (progress >= 100) {
      clearInterval(loadingInterval);
      
      setTimeout(() => {
        // Hide loading screen
        gsap.to(loadingScreen, {
          opacity: 0,
          duration: 1,
          ease: 'power2.inOut',
          onComplete: () => {
            loadingScreen.classList.remove('active');
            loadingScreen.classList.add('hidden');
            
            // Start background music after loading
            if (musicEnabled) {
              playBackgroundMusic();
            }
            
            // Animate game elements in
            gsap.from('#hud', {
              opacity: 0,
              y: -50,
              duration: 1,
              delay: 0.2,
              ease: 'back.out(1.7)'
            });
            
            gsap.from('#mobile-nav', {
              opacity: 0,
              y: 100,
              duration: 1,
              delay: 0.4,
              ease: 'back.out(1.7)'
            });
          }
        });
      }, 800);
    }
  }, 200 + Math.random() * 300); // Random timing for more realistic loading
}

function createLoadingParticles() {
  const particleContainer = document.getElementById('loading-particles');
  
  // Create initial set of particles
  for (let i = 0; i < 15; i++) {
    setTimeout(() => {
      createLoadingParticle(particleContainer);
    }, i * 200);
  }
  
  // Continuously create new particles during loading
  const particleInterval = setInterval(() => {
    createLoadingParticle(particleContainer);
  }, 600);
  
  // Store interval for cleanup if needed
  window.titleParticleInterval = particleInterval;
}

function createLoadingParticle(container) {
  const particle = document.createElement('div');
  particle.classList.add('loading-particle');
  
  // Random starting position
  particle.style.left = Math.random() * 100 + '%';
  particle.style.animationDelay = Math.random() * 3 + 's';
  particle.style.animationDuration = (15 + Math.random() * 10) + 's';
  
  // Create random color variation
  const colors = ['var(--primary-blue)', 'var(--primary-green)', 'var(--primary-purple)'];
  const randomColor = colors[Math.floor(Math.random() * colors.length)];
  particle.style.background = `radial-gradient(circle, ${randomColor} 0%, transparent 70%)`;
  
  container.appendChild(particle);
  
  // Remove particle after animation
  setTimeout(() => {
    if (particle.parentNode) {
      particle.remove();
    }
  }, 25000);
}

function initializeParticleSystem() {
  // Enhanced particle effects for better visual feedback
  const style = document.createElement('style');
  style.textContent = `
    @keyframes particleFloat {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    .enhanced-particle {
      animation: particleFloat 2s ease-out forwards;
    }
  `;
  document.head.appendChild(style);
}

function startGlowAnimations() {
  // Add subtle glow effects to key UI elements
  const hudElement = document.getElementById('hud');
  if (hudElement) {
    hudElement.classList.add('glow-effect');
  }
}

document.addEventListener('DOMContentLoaded', initializeGame);

function isLocalStorageAvailable() {
  try {
    const test = '__storage_test__';
    localStorage.setItem(test, test);
    localStorage.removeItem(test);
    return true;
  } catch(e) {
    return false;
  }
}

let totalLifeProduced = 0;
let totalClicks = 0;
let humansCreated = 0;
let animalsCreated = 0;

function initializeAudio() {
  audioPlayer = new Audio();
  audioPlayer.src = 'audio/clicksound.mp3'; 
  audioPlayer.preload = 'auto';

  musicPlayer = new Audio(); 
  musicPlayer.src = 'audio/background.mp3'; 
  musicPlayer.preload = 'auto';
  musicPlayer.loop = true;
  
  // Don't auto-play music until after title screen
}

function playClickSound() {
  if (audioEnabled && audioPlayer) {
    const sound = audioPlayer.cloneNode();
    sound.play().catch(err => console.log('Click sound failed:', err));
  }
}

function playBackgroundMusic() {
  if (musicEnabled && musicPlayer) {
    musicPlayer.play().catch(err => {
      console.log('Background music start failed:', err);
      // Retry on next user interaction
      document.addEventListener('click', function retryMusic() {
        musicPlayer.play().catch(err => console.log('Retry failed:', err));
        document.removeEventListener('click', retryMusic);
      }, {once: true});
    });
  }
}

function toggleBackgroundMusic() {
  if (musicEnabled) {
    playBackgroundMusic();
  } else {
    if (musicPlayer) {
      musicPlayer.pause();
    }
  }
}

let life = 0;
let humans = 0;
let animals = 0;
let planetsProduced = 0;
let lifePerSecond = 0;
let lifePerClick = 1;
let planetUpgradeCost = 10;
let humanUpgradeCost = 100;
let animalUpgradeCost = 50;
let clickUpgradeCost = 50;
let educationLevel = 0;
let technologyLevel = 0;
let ecosystemLevel = 0;
let biodiversityLevel = 0;
let educationUpgradeCost = 200;
let technologyUpgradeCost = 500;
let ecosystemUpgradeCost = 150;
let biodiversityUpgradeCost = 300;
let agricultureUpgradeCost = 250;
let conservationUpgradeCost = 350;
let gameSeconds = 0;
let gameDays = 0;
let gameYears = 0;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 5;

function formatNumber(num) {
  const shortNotation = document.getElementById('toggle-short-notation').textContent === 'Short Numbers: On';
  if (!shortNotation || num < 1000) return num.toFixed(0);
  const suffixes = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc', 'Ud', 'Dd', 'Td', 'Qad', 'Qid', 'Sxd', 'Spd', 'Ocd', 'Nod', 'Vg'];
  const order = Math.floor(Math.log10(num) / 3);
  return (num / Math.pow(10, order * 3)).toFixed(1) + suffixes[order];
}

function formatTime(seconds) {
  const days = Math.floor(seconds / 86400);
  const hours = Math.floor((seconds % 86400) / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = Math.floor(seconds % 60);
  
  if (days > 0) {
    return `${days}d ${hours}h ${minutes}m`;
  } else if (hours > 0) {
    return `${hours}h ${minutes}m`;
  } else if (minutes > 0) {
    return `${minutes}m ${secs}s`;
  } else {
    return `${secs}s`;
  }
}

function calculateOfflineProgress(lastActiveTime) {
  const currentTime = Date.now();
  const timeDiff = (currentTime - lastActiveTime) / 1000;

  if (timeDiff > 60) {
    const offlineLife = lifePerSecond * timeDiff;

    const humanProduction = Math.floor((humans * timeDiff) / 100);
    const animalProduction = Math.floor((animals * timeDiff) / 100);

    life += offlineLife;
    totalLifeProduced += offlineLife;
    humansCreated += humanProduction;
    animalsCreated += animalProduction;

    const offlineSeconds = Math.floor(timeDiff);
    gameSeconds += offlineSeconds % 86400;
    const additionalDays = Math.floor(offlineSeconds / 86400);
    gameDays += additionalDays % 365;
    gameYears += Math.floor(additionalDays / 365);

    while (gameSeconds >= 86400) {
      gameSeconds -= 86400;
      gameDays++;
    }
    while (gameDays >= 365) {
      gameDays -= 365;
      gameYears++;
    }

    updateStats();

    return {
      lifeGained: offlineLife,
      timePassed: timeDiff,
      humansGained: humanProduction,
      animalsGained: animalProduction
    };
  }

  return null;
}

function showOfflineProgressNotification(lifeGained, timePassed, humansGained, animalsGained) {
  const notification = document.createElement('div');
  notification.id = 'offline-progress-notification';
  notification.innerHTML = `
    <p>ğŸŒŸ ${getText('welcomeBack')}</p>
    <p>â±ï¸ ${getText('offlineFor')} ${formatTime(timePassed)}</p>
    <p><strong>${getText('evolutionProgress')}</strong></p>
    <p>ğŸ§¬ ${formatNumber(lifeGained)} ${getText('life')}</p>
    ${humansGained > 0 ? `<p>ğŸ‘¥ ${formatNumber(humansGained)} ${getText('newHumans')}</p>` : ''}
    ${animalsGained > 0 ? `<p>ğŸ¾ ${formatNumber(animalsGained)} ${getText('newAnimals')}</p>` : ''}
  `;
  
  // Enhanced notification styling
  notification.style.transform = 'translateX(-50%) translateY(20px)';
  notification.style.opacity = '0';
  document.body.appendChild(notification);

  // Smooth entrance animation
  gsap.to(notification, {
    opacity: 1,
    y: 0,
    duration: 0.6,
    ease: 'back.out(1.7)'
  });

  setTimeout(() => {
    gsap.to(notification, {
      opacity: 0,
      y: -20,
      duration: 0.5,
      ease: 'power2.in',
      onComplete: () => notification.remove()
    });
  }, audioEnabled ? 3500 : 5000);
}

function loadGame() {
  if (!isLocalStorageAvailable()) {
    console.warn("localStorage is not available. Unable to load saved game.");
    initializeDefaultValues();
    return;
  }

  try {
    const savedState = localStorage.getItem('planetIdleGame');
    if (savedState) {
      const gameState = JSON.parse(savedState);

      life = gameState.life || 0;
      humans = gameState.humans || 0;
      animals = gameState.animals || 0;
      planetsProduced = gameState.planetsProduced || 0;
      lifePerSecond = gameState.lifePerSecond || 0;
      lifePerClick = gameState.lifePerClick || 1;
      planetUpgradeCost = gameState.planetUpgradeCost || 10;
      humanUpgradeCost = gameState.humanUpgradeCost || 100;
      animalUpgradeCost = gameState.animalUpgradeCost || 50;
      clickUpgradeCost = gameState.clickUpgradeCost || 50;
      educationLevel = gameState.educationLevel || 0;
      technologyLevel = gameState.technologyLevel || 0;
      ecosystemLevel = gameState.ecosystemLevel || 0;
      biodiversityLevel = gameState.biodiversityLevel || 0;
      educationUpgradeCost = gameState.educationUpgradeCost || 200;
      technologyUpgradeCost = gameState.technologyUpgradeCost || 500;
      ecosystemUpgradeCost = gameState.ecosystemUpgradeCost || 150;
      biodiversityUpgradeCost = gameState.biodiversityUpgradeCost || 300;
      agricultureUpgradeCost = gameState.agricultureUpgradeCost || 250;
      conservationUpgradeCost = gameState.conservationUpgradeCost || 350;
      totalLifeProduced = gameState.totalLifeProduced || 0;
      totalClicks = gameState.totalClicks || 0;
      humansCreated = gameState.humansCreated || 0;
      animalsCreated = gameState.animalsCreated || 0;
      gameSeconds = gameState.gameSeconds || 0;
      gameDays = gameState.gameDays || 0;
      gameYears = gameState.gameYears || 0;
      audioEnabled = gameState.isSoundEnabled !== undefined ? gameState.isSoundEnabled : true;
      musicEnabled = gameState.isMusicEnabled !== undefined ? gameState.isMusicEnabled : true;
      hapticEnabled = gameState.isHapticEnabled !== undefined ? gameState.isHapticEnabled : true;
      currentLanguage = gameState.currentLanguage || 'en';

      const soundBtn = document.getElementById('toggle-sound');
      const musicBtn = document.getElementById('toggle-music');
      const hapticBtn = document.getElementById('toggle-haptic');
      if (soundBtn) soundBtn.textContent = `${getText('soundEffects')}: ${audioEnabled ? getText('on') : getText('off')}`;
      if (musicBtn) musicBtn.textContent = `${getText('music')}: ${musicEnabled ? getText('on') : getText('off')}`;
      if (hapticBtn) hapticBtn.textContent = `${getText('hapticFeedback')}: ${hapticEnabled ? getText('on') : getText('off')}`;

      const offlineProgress = calculateOfflineProgress(parseInt(localStorage.getItem('lastActiveTime') || Date.now().toString(), 10));
      if (offlineProgress) {
        showOfflineProgressNotification(
          offlineProgress.lifeGained,
          offlineProgress.timePassed,
          offlineProgress.humansGained,
          offlineProgress.animalsGained
        );
      }

      updateCounters();
      updateStats();
      updateAllUpgradeButtonTexts();
    } else {
      console.log("No saved game found. Starting a new game.");
      initializeDefaultValues();
    }
  } catch (error) {
    console.error("Failed to load game state:", error);
    initializeDefaultValues();
  }
}

function saveGame() {
  if (!isLocalStorageAvailable()) {
    console.warn("localStorage is not available. Game progress will not be saved.");
    return;
  }

  try {
    const gameState = {
      life,
      humans,
      animals,
      planetsProduced,
      lifePerSecond,
      lifePerClick,
      planetUpgradeCost,
      humanUpgradeCost,
      animalUpgradeCost,
      clickUpgradeCost,
      educationLevel,
      technologyLevel,
      ecosystemLevel,
      biodiversityLevel,
      educationUpgradeCost,
      technologyUpgradeCost,
      ecosystemUpgradeCost,
      biodiversityUpgradeCost,
      agricultureUpgradeCost,
      conservationUpgradeCost,
      totalLifeProduced,
      totalClicks,
      humansCreated,
      animalsCreated,
      gameSeconds,
      gameDays,
      gameYears,
      isSoundEnabled: audioEnabled,
      isMusicEnabled: musicEnabled,
      isHapticEnabled: hapticEnabled,
      currentLanguage: currentLanguage,
    };
    localStorage.setItem('planetIdleGame', JSON.stringify(gameState));
    localStorage.setItem('lastActiveTime', Date.now().toString());
  } catch (error) {
    console.error("Failed to save game state:", error);
  }
}

function autosave() {
  saveGame();
  console.log('Game autosaved');
}

function autoload() {
  loadGame();
  console.log('Game autoloaded');
}

document.addEventListener('DOMContentLoaded', () => {
  loadGame();
  initMobileTabs();
  updateStats();
  autosave();
  autoload();
});

setInterval(() => {
  autosave();
  autoload();
}, 30000);

document.getElementById('toggle-music').addEventListener('click', () => {
  musicEnabled = !musicEnabled;
  document.getElementById('toggle-music').textContent = `Music: ${musicEnabled ? getText('on') : getText('off')}`;
  
  // Add haptic feedback
  if (window.hapticFeedback) {
    window.hapticFeedback([25]);
  }
  
  if (musicEnabled) {
    playBackgroundMusic();
  } else {
    if (musicPlayer) {
      musicPlayer.pause();
    }
  }
});

document.getElementById('toggle-sound').addEventListener('click', () => {
  audioEnabled = !audioEnabled;
  document.getElementById('toggle-sound').textContent = `Sound Effects: ${audioEnabled ? getText('on') : getText('off')}`; 
  
  // Add haptic feedback
  if (window.hapticFeedback) {
    window.hapticFeedback([25]);
  }
});

document.getElementById('toggle-vignette').addEventListener('click', () => {
  const vignetteOverlay = document.getElementById('vignette-overlay');
  const btn = document.getElementById('toggle-vignette');
  const isActive = vignetteOverlay.classList.contains('active');
  
  // Add haptic feedback
  if (window.hapticFeedback) {
    window.hapticFeedback([25]);
  }
  
  if (isActive) {
    vignetteOverlay.classList.remove('active');
    btn.textContent = `${getText('vignetteEffect')}: ${getText('off')}`;
  } else {
    vignetteOverlay.classList.add('active');
    btn.textContent = `${getText('vignetteEffect')}: ${getText('on')}`;
  }
});

document.getElementById('toggle-haptic').addEventListener('click', () => {
  hapticEnabled = !hapticEnabled;
  const btn = document.getElementById('toggle-haptic');
  btn.textContent = `${getText('hapticFeedback')}: ${hapticEnabled ? getText('on') : getText('off')}`;
  
  // Provide haptic feedback for the toggle action (if enabled)
  if (hapticEnabled && window.hapticFeedback) {
    window.hapticFeedback([30]);
  }
  
  // Save the setting
  saveGame();
});

// Android-optimized reset functionality
document.getElementById('confirm-reset').addEventListener('click', () => {
  const modal = document.getElementById('reset-modal');
  modal.style.display = 'flex';
  
  // Add haptic feedback
  if (window.hapticFeedback) {
    window.hapticFeedback([50]);
  }
  
  // Animate modal in
  gsap.fromTo(modal.children[0], 
    { opacity: 0, scale: 0.8, y: 50 },
    { opacity: 1, scale: 1, y: 0, duration: 0.4, ease: 'back.out(1.7)' }
  );
});

document.getElementById('cancel-reset').addEventListener('click', () => {
  const modal = document.getElementById('reset-modal');
  
  // Animate modal out
  gsap.to(modal.children[0], {
    opacity: 0,
    scale: 0.8,
    y: -50,
    duration: 0.3,
    ease: 'power2.in',
    onComplete: () => {
      modal.style.display = 'none';
    }
  });
});

document.getElementById('confirm-reset-final').addEventListener('click', () => {
  const modal = document.getElementById('reset-modal');
  
  // Add stronger haptic feedback for final action
  if (window.hapticFeedback) {
    window.hapticFeedback([100, 50, 100]);
  }
  
  // Animate modal out
  gsap.to(modal.children[0], {
    opacity: 0,
    scale: 0.8,
    y: -50,
    duration: 0.3,
    ease: 'power2.in',
    onComplete: () => {
      modal.style.display = 'none';
      performGameReset();
    }
  });
});

// Close modal if clicking outside on desktop
document.getElementById('reset-modal').addEventListener('click', (e) => {
  if (e.target.id === 'reset-modal' && !isMobile) {
    document.getElementById('cancel-reset').click();
  }
});

function performGameReset() {
  try {
    // Clear all localStorage data
    localStorage.removeItem('planetIdleGame');
    localStorage.removeItem('lastActiveTime');
    
    // Reset all game variables to initial state
    life = 0;
    humans = 0;
    animals = 0;
    planetsProduced = 0;
    lifePerSecond = 0;
    lifePerClick = 1;
    planetUpgradeCost = 10;
    humanUpgradeCost = 100;
    animalUpgradeCost = 50;
    clickUpgradeCost = 50;
    educationLevel = 0;
    technologyLevel = 0;
    ecosystemLevel = 0;
    biodiversityLevel = 0;
    educationUpgradeCost = 200;
    technologyUpgradeCost = 500;
    ecosystemUpgradeCost = 150;
    biodiversityUpgradeCost = 300;
    agricultureUpgradeCost = 250;
    conservationUpgradeCost = 350;
    totalLifeProduced = 0;
    totalClicks = 0;
    humansCreated = 0;
    animalsCreated = 0;
    gameSeconds = 0;
    gameDays = 0;
    gameYears = 0;
    
    // Update UI immediately
    updateCounters();
    updateStats();
    updateAllUpgradeButtonTexts();
    
    // Show reset confirmation with animation
    const resetNotification = document.createElement('div');
    resetNotification.style.cssText = `
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      color: var(--text-primary);
      padding: 15px 25px;
      border-radius: 15px;
      border: 1px solid var(--success);
      box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
      z-index: 1002;
      font-weight: 500;
      opacity: 0;
    `;
    resetNotification.textContent = 'âœ… Game progress has been reset';
    document.body.appendChild(resetNotification);
    
    // Animate notification
    gsap.to(resetNotification, {
      opacity: 1,
      y: -20,
      duration: 0.5,
      ease: 'back.out(1.7)',
      onComplete: () => {
        setTimeout(() => {
          gsap.to(resetNotification, {
            opacity: 0,
            y: -40,
            duration: 0.3,
            onComplete: () => resetNotification.remove()
          });
        }, 2000);
      }
    });
    
  } catch (error) {
    console.error('Error resetting game:', error);
    
    // Show error notification
    const errorNotification = document.createElement('div');
    errorNotification.style.cssText = `
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      color: var(--danger);
      padding: 15px 25px;
      border-radius: 15px;
      border: 1px solid var(--danger);
      box-shadow: 0 10px 30px rgba(255, 51, 102, 0.3);
      z-index: 1002;
      font-weight: 500;
      opacity: 0;
    `;
    errorNotification.textContent = 'âŒ Reset failed. Please refresh the page.';
    document.body.appendChild(errorNotification);
    
    gsap.to(errorNotification, {
      opacity: 1,
      duration: 0.5,
      onComplete: () => {
        setTimeout(() => {
          gsap.to(errorNotification, {
            opacity: 0,
            duration: 0.3,
            onComplete: () => errorNotification.remove()
          });
        }, 3000);
      }
    });
  }
}

document.getElementById('language-selector').addEventListener('click', () => {
  // Cycle through available languages
  const languageKeys = Object.keys(languages);
  const currentIndex = languageKeys.indexOf(currentLanguage);
  const nextIndex = (currentIndex + 1) % languageKeys.length;
  currentLanguage = languageKeys[nextIndex];
  
  // Add haptic feedback
  if (window.hapticFeedback) {
    window.hapticFeedback([30]);
  }
  
  // Update all text immediately
  updateLanguage();
  
  // Save the language preference
  saveGame();
  
  // Update the button text
  const btn = document.getElementById('language-selector');
  btn.innerHTML = `${getText('language')}: ${languages[currentLanguage].flag} ${languages[currentLanguage].name}`;
  
  // Animate button to show change
  gsap.fromTo(btn, 
    { scale: 1 }, 
    { scale: 1.05, duration: 0.1, yoyo: true, repeat: 1, ease: 'power2.inOut' }
  );
});

function updateCounters() {
  const lifeCounter = document.getElementById('life-counter');
  const humansCounter = document.getElementById('humans-counter');
  const animalsCounter = document.getElementById('animals-counter');
  const lpsCounter = document.getElementById('lps-counter');
  
  if (lifeCounter) lifeCounter.textContent = `${getText('life')}: ${formatNumber(life)}`;
  if (humansCounter) humansCounter.textContent = `${getText('humans')}: ${formatNumber(humans)}`;
  if (animalsCounter) animalsCounter.textContent = `${getText('animals')}: ${formatNumber(animals)}`;
  if (lpsCounter) lpsCounter.textContent = `${getText('lifePerSecond')}: ${formatNumber(lifePerSecond)}`;
}

function upgradePlanet() {
  if (life >= planetUpgradeCost) {
    life -= planetUpgradeCost;
    planetsProduced++;
    totalLifeProduced += lifePerClick; 
    lifePerSecond += 0.1;
    planetUpgradeCost = Math.floor(planetUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([40]);
    }
    
    updateUpgradeButtonText('planet-upgrade', getText('upgradePlanet'), planetUpgradeCost);
    updateCounters();
    updateStats();
  }
}

function createHumans() {
  if (life >= humanUpgradeCost) {
    life -= humanUpgradeCost;
    humans += 10;
    humansCreated += 10; 
    lifePerSecond += 1;
    humanUpgradeCost = Math.floor(humanUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([50]);
    }
    
    updateUpgradeButtonText('human-upgrade', getText('createHumans'), humanUpgradeCost);
    updateCounters();
    updateStats();
  }
}

function createAnimals() {
  if (life >= animalUpgradeCost) {
    life -= animalUpgradeCost;
    animals += 5;
    animalsCreated += 5; 
    lifePerSecond += 0.5;
    animalUpgradeCost = Math.floor(animalUpgradeCost * 1.3);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([35]);
    }
    
    updateUpgradeButtonText('animal-upgrade', getText('createAnimals'), animalUpgradeCost);
    updateCounters();
    updateStats();
  }
}

function upgradeClick() {
  if (life >= clickUpgradeCost) {
    life -= clickUpgradeCost;
    lifePerClick += 1;
    clickUpgradeCost = Math.floor(clickUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([45]);
    }
    
    updateUpgradeButtonText('click-upgrade', getText('upgradeClick'), clickUpgradeCost);
    updateCounters();
  }
}

function upgradeEducation() {
  if (life >= educationUpgradeCost) {
    life -= educationUpgradeCost;
    educationLevel++;
    lifePerSecond += 2;
    educationUpgradeCost = Math.floor(educationUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([60]);
    }
    
    updateUpgradeButtonText('education-upgrade', getText('educationSystem'), educationUpgradeCost);
    updateCounters();
  }
}

function upgradeTechnology() {
  if (life >= technologyUpgradeCost) {
    life -= technologyUpgradeCost;
    technologyLevel++;
    lifePerSecond += 5;
    technologyUpgradeCost = Math.floor(technologyUpgradeCost * 1.6);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([70]);
    }
    
    updateUpgradeButtonText('technology-upgrade', getText('technologicalAdvancement'), technologyUpgradeCost);
    updateCounters();
  }
}

function upgradeEcosystem() {
  if (life >= ecosystemUpgradeCost) {
    life -= ecosystemUpgradeCost;
    ecosystemLevel++;
    lifePerSecond += 1.5;
    ecosystemUpgradeCost = Math.floor(ecosystemUpgradeCost * 1.4);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([45]);
    }
    
    updateUpgradeButtonText('ecosystem-upgrade', getText('enhanceEcosystem'), ecosystemUpgradeCost);
    updateCounters();
  }
}

function upgradeBiodiversity() {
  if (life >= biodiversityUpgradeCost) {
    life -= biodiversityUpgradeCost;
    biodiversityLevel++;
    lifePerSecond += 3;
    biodiversityUpgradeCost = Math.floor(biodiversityUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([55]);
    }
    
    updateUpgradeButtonText('biodiversity-upgrade', getText('increaseBiodiversity'), biodiversityUpgradeCost);
    updateCounters();
  }
}

function upgradeAgriculture() {
  if (life >= agricultureUpgradeCost) {
    life -= agricultureUpgradeCost;
    lifePerSecond += 2;
    agricultureUpgradeCost = Math.floor(agricultureUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([40]);
    }
    
    updateUpgradeButtonText('agriculture-upgrade', getText('developAgriculture'), agricultureUpgradeCost);
    updateCounters();
  }
}

function upgradeConservation() {
  if (life >= conservationUpgradeCost) {
    life -= conservationUpgradeCost;
    lifePerSecond += 3;
    conservationUpgradeCost = Math.floor(conservationUpgradeCost * 1.5);
    
    // Add haptic feedback for successful upgrade
    if (window.hapticFeedback) {
      window.hapticFeedback([50]);
    }
    
    updateUpgradeButtonText('conservation-upgrade', getText('wildlifeConservation'), conservationUpgradeCost);
    updateCounters();
  }
}

document.getElementById('planet-upgrade').addEventListener('click', upgradePlanet);
document.getElementById('human-upgrade').addEventListener('click', createHumans);
document.getElementById('animal-upgrade').addEventListener('click', createAnimals);
document.getElementById('click-upgrade').addEventListener('click', upgradeClick);
document.getElementById('education-upgrade').addEventListener('click', upgradeEducation);
document.getElementById('technology-upgrade').addEventListener('click', upgradeTechnology);
document.getElementById('ecosystem-upgrade').addEventListener('click', upgradeEcosystem);
document.getElementById('biodiversity-upgrade').addEventListener('click', upgradeBiodiversity);
document.getElementById('agriculture-upgrade').addEventListener('click', upgradeAgriculture);
document.getElementById('conservation-upgrade').addEventListener('click', upgradeConservation);

function updateAllUpgradeButtonTexts() {
  updateUpgradeButtonText('planet-upgrade', getText('upgradePlanet'), planetUpgradeCost);
  updateUpgradeButtonText('human-upgrade', getText('createHumans'), humanUpgradeCost);
  updateUpgradeButtonText('animal-upgrade', getText('createAnimals'), animalUpgradeCost);
  updateUpgradeButtonText('click-upgrade', getText('upgradeClick'), clickUpgradeCost);
  updateUpgradeButtonText('education-upgrade', getText('educationSystem'), educationUpgradeCost);
  updateUpgradeButtonText('technology-upgrade', getText('technologicalAdvancement'), technologyUpgradeCost);
  updateUpgradeButtonText('ecosystem-upgrade', getText('enhanceEcosystem'), ecosystemUpgradeCost);
  updateUpgradeButtonText('biodiversity-upgrade', getText('increaseBiodiversity'), biodiversityUpgradeCost);
  updateUpgradeButtonText('agriculture-upgrade', getText('developAgriculture'), agricultureUpgradeCost);
  updateUpgradeButtonText('conservation-upgrade', getText('wildlifeConservation'), conservationUpgradeCost);
}

function updateUpgradeButtonText(id, text, cost) {
  const button = document.getElementById(id);
  if (button) {
    button.textContent = `${text} (${getText('cost')}: ${formatNumber(cost)} ${getText('life')})`;
  }
}

function resetGame() {
  // This function is now replaced by the modal system
  // Keeping for backward compatibility but redirecting to new system
  document.getElementById('confirm-reset').click();
}

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  updateSharpness();
});

function initMobileTabs() {
  const navButtons = document.querySelectorAll('.nav-btn');
  const tabPanes = document.querySelectorAll('.tab-pane');

  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const tabName = btn.getAttribute('data-tab');

      // Add haptic feedback for navigation
      if (window.hapticFeedback) {
        window.hapticFeedback([20]);
      }

      navButtons.forEach(b => b.classList.remove('active'));
      tabPanes.forEach(p => p.classList.remove('active'));

      btn.classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
    });
  });
}

document.addEventListener('DOMContentLoaded', initMobileTabs);

function initializeDefaultValues() {
  life = 0;
  humans = 0;
  animals = 0;
  planetsProduced = 0;
  lifePerSecond = 0;
  lifePerClick = 1;
  planetUpgradeCost = 10;
  humanUpgradeCost = 100;
  animalUpgradeCost = 50;
  clickUpgradeCost = 50;
  educationLevel = 0;
  technologyLevel = 0;
  ecosystemLevel = 0;
  biodiversityLevel = 0;
  educationUpgradeCost = 200;
  technologyUpgradeCost = 500;
  ecosystemUpgradeCost = 150;
  biodiversityUpgradeCost = 300;
  agricultureUpgradeCost = 250;
  conservationUpgradeCost = 350;
  totalLifeProduced = 0;
  totalClicks = 0;
  humansCreated = 0;
  animalsCreated = 0;
  gameSeconds = 0;
  gameDays = 0;
  gameYears = 0;
  audioEnabled = true;
  musicEnabled = true;
  hapticEnabled = true;
  currentLanguage = 'en';
}

function createTitleParticles() {
  const particleContainer = document.getElementById('title-particles');
  
  // Create initial set of particles
  for (let i = 0; i < 20; i++) {
    setTimeout(() => {
      createTitleParticle(particleContainer);
    }, i * 300);
  }
  
  // Continuously create new particles
  const particleInterval = setInterval(() => {
    createTitleParticle(particleContainer);
  }, 800);
  
  // Store interval for cleanup if needed
  window.titleParticleInterval = particleInterval;
}

function createTitleParticle(container) {
  const particle = document.createElement('div');
  particle.classList.add('title-particle');
  
  // Random starting position
  particle.style.left = Math.random() * 100 + '%';
  particle.style.animationDelay = Math.random() * 2 + 's';
  particle.style.animationDuration = (15 + Math.random() * 10) + 's';
  
  // Create random color variation
  const colors = ['var(--primary-blue)', 'var(--primary-green)', 'var(--primary-purple)'];
  const randomColor = colors[Math.floor(Math.random() * colors.length)];
  particle.style.background = `radial-gradient(circle, ${randomColor} 0%, transparent 70%)`;
  
  container.appendChild(particle);
  
  // Remove particle after animation
  setTimeout(() => {
    if (particle.parentNode) {
      particle.remove();
    }
  }, 25000);
}

setInterval(() => {
  life += lifePerSecond;
  totalLifeProduced += lifePerSecond; 
  updateCounters();
  updateStats();
}, 1000);

// Enhanced touch event handling
document.getElementById('game-container').addEventListener('touchstart', function(e) {
  e.preventDefault();
  touchStartTime = e.timeStamp;
}, { passive: false });

document.getElementById('game-container').addEventListener('touchend', function(e) {
  e.preventDefault();
  const touchDuration = e.timeStamp - touchStartTime;
  if (touchDuration < 300 && !isProcessingClick) { // Short tap and not already processing
    handleClick(e);
  }
}, { passive: false });

// Add click event for desktop
document.getElementById('game-container').addEventListener('click', function(e) {
  if (!isMobile && !isProcessingClick) {
    handleClick(e);
  }
});

function handleClick(event) {
  // Prevent duplicate clicks on Android
  const currentTime = Date.now();
  if (isProcessingClick || currentTime - lastClickTime < 100) {
    return;
  }
  
  isProcessingClick = true;
  lastClickTime = currentTime;
  
  event.preventDefault();
  
  // Enhanced touch handling for Android
  let x, y;
  if (event.touches && event.touches.length > 0) {
    x = event.touches[0].clientX;
    y = event.touches[0].clientY;
  } else if (event.changedTouches && event.changedTouches.length > 0) {
    x = event.changedTouches[0].clientX;
    y = event.changedTouches[0].clientY;
  } else {
    x = event.clientX;
    y = event.clientY;
  }

  if (x === undefined || y === undefined) {
    isProcessingClick = false;
    return;
  }

  // Add haptic feedback on Android
  if (isAndroid && window.hapticFeedback) {
    window.hapticFeedback([10]); // Short vibration
  }

  life += lifePerClick;
  totalClicks++;
  totalLifeProduced += lifePerClick;
  updateCounters();
  updateStats();
  
  if (!audioPlayer) {
    initializeAudio();
  }
  
  playClickSound();
  
  // Create click text with proper cleanup
  createClickText(x, y, lifePerClick);
  
  // Create particle effect with proper cleanup
  createClickParticle(x, y);

  // Enhanced screen shake effect for desktop only
  if (lifePerClick > 50 && !isMobile) {
    gsap.to('#game-container', {
      x: Math.random() * 4 - 2,
      y: Math.random() * 4 - 2,
      duration: 0.1,
      repeat: 3,
      yoyo: true,
      ease: 'power2.inOut',
      onComplete: () => {
        gsap.set('#game-container', { x: 0, y: 0 });
      }
    });
  }
  
  // Reset processing flag after a delay
  setTimeout(() => {
    isProcessingClick = false;
  }, 50);
}

function createClickText(x, y, amount) {
  const clickText = document.createElement('div');
  clickText.textContent = `+${formatNumber(amount)}`;
  clickText.classList.add('click-text');
  clickText.style.left = `${x}px`;
  clickText.style.top = `${y}px`;
  clickText.style.fontSize = amount > 100 ? '28px' : '24px';
  clickText.style.pointerEvents = 'none';
  clickText.style.zIndex = '1000';
  clickText.style.position = 'absolute';
  clickText.style.willChange = 'transform, opacity';
  
  document.body.appendChild(clickText);

  // Optimized animation for mobile
  const duration = isMobile ? 0.8 : 1.2;
  gsap.to(clickText, {
    opacity: 0,
    y: -60,
    scale: 1.2,
    duration: duration,
    ease: 'power2.out',
    onComplete: () => {
      if (clickText.parentNode) {
        clickText.parentNode.removeChild(clickText);
      }
    }
  });
}

function createClickParticle(x, y) {
  const particle = document.createElement('div');
  particle.classList.add('life-particle');
  particle.style.left = `${x}px`;
  particle.style.top = `${y}px`;
  particle.style.position = 'absolute';
  particle.style.width = '24px';
  particle.style.height = '24px';
  particle.style.background = 'radial-gradient(circle, var(--primary-green) 0%, transparent 70%)';
  particle.style.borderRadius = '50%';
  particle.style.pointerEvents = 'none';
  particle.style.zIndex = '1000';
  particle.style.willChange = 'transform, opacity';
  particle.style.boxShadow = '0 0 15px var(--primary-green), 0 0 30px var(--primary-green), inset 0 0 10px rgba(255, 255, 255, 0.3)';
  
  document.body.appendChild(particle);

  const lifeCounter = document.getElementById('life-counter');
  const lifeCounterRect = lifeCounter.getBoundingClientRect();
  const targetX = lifeCounterRect.left + lifeCounterRect.width / 2;
  const targetY = lifeCounterRect.top + lifeCounterRect.height / 2;

  const duration = isMobile ? 1.0 : 1.5;
  gsap.to(particle, {
    x: targetX - x,
    y: targetY - y,
    opacity: 0,
    scale: 0.3,
    duration: duration,
    ease: 'power2.in',
    onComplete: () => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }
  });
}

function updateCameraPosition() {
  const time = Date.now() * 0.0005;
  camera.position.set(0, 0, 3); 
  camera.lookAt(earth.position);
}

function updateSharpness() {
  const pixelRatio = window.devicePixelRatio;
  renderer.setPixelRatio(pixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function updateStats() {
  const totalLifeStat = document.getElementById('total-life-stat');
  const totalClicksStat = document.getElementById('total-clicks-stat');
  const planetsProducedStat = document.getElementById('planets-produced-stat');
  const humansCreatedStat = document.getElementById('humans-created-stat');
  const animalsCreatedStat = document.getElementById('animals-created-stat');
  const timePlayedStat = document.getElementById('time-played-stat');
  
  if (totalLifeStat) totalLifeStat.textContent = formatNumber(totalLifeProduced);
  if (totalClicksStat) totalClicksStat.textContent = formatNumber(totalClicks);
  if (planetsProducedStat) planetsProducedStat.textContent = formatNumber(planetsProduced);
  if (humansCreatedStat) humansCreatedStat.textContent = formatNumber(humansCreated);
  if (animalsCreatedStat) animalsCreatedStat.textContent = formatNumber(animalsCreated);
  if (timePlayedStat) timePlayedStat.textContent = formatTimePlayed();
}

function formatTimePlayed() {
  const totalSeconds = gameYears * 365 * 86400 + gameDays * 86400 + gameSeconds;
  const days = Math.floor(totalSeconds / 86400);
  const hours = Math.floor((totalSeconds % 86400) / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;
  return `${days} ${getText('days')}, ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function updateTimeCounter() {
  gameSeconds++;
  if (gameSeconds >= 86400) {
    gameSeconds = 0;
    gameDays++;
    if (gameDays >= 365) {
      gameDays = 0;
      gameYears++;
    }
  }
  
  const timeCounter = document.getElementById('time-counter');
  if (timeCounter) {
    const hours = Math.floor(gameSeconds / 3600);
    const minutes = Math.floor((gameSeconds % 3600) / 60);
    const seconds = gameSeconds % 60;
    timeCounter.textContent = `${getText('year')} ${gameYears}, ${getText('day')} ${gameDays}, ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.2;
document.getElementById('game-container').appendChild(renderer.domElement);

const starsGeometry = new THREE.BufferGeometry();
const starsMaterial = new THREE.PointsMaterial({
  vertexColors: true,
  size: 2,
  sizeAttenuation: true,
  transparent: true,
  opacity: 0.8,
  blending: THREE.AdditiveBlending
});

const starsVertices = [];
const starsColors = [];
const starsSizes = [];

// Create more realistic star colors and sizes
const starTypes = [
  { color: [1.0, 1.0, 1.0], weight: 0.4 }, // White
  { color: [1.0, 0.9, 0.7], weight: 0.25 }, // Yellow-white
  { color: [0.9, 0.9, 1.0], weight: 0.15 }, // Blue-white
  { color: [1.0, 0.7, 0.4], weight: 0.1 }, // Orange
  { color: [1.0, 0.4, 0.2], weight: 0.05 }, // Red
  { color: [0.7, 0.8, 1.0], weight: 0.05 } // Blue
];

for (let i = 0; i < 15000; i++) {
  // Create more varied positioning with depth layers
  const distance = Math.random() * 1500 + 200;
  const theta = Math.random() * Math.PI * 2;
  const phi = Math.random() * Math.PI;
  
  const x = distance * Math.sin(phi) * Math.cos(theta);
  const y = distance * Math.sin(phi) * Math.sin(theta);
  const z = distance * Math.cos(phi);
  
  starsVertices.push(x, y, z);
  
  // Assign star color based on realistic distribution
  let selectedType = starTypes[0];
  const rand = Math.random();
  let cumulative = 0;
  
  for (const type of starTypes) {
    cumulative += type.weight;
    if (rand <= cumulative) {
      selectedType = type;
      break;
    }
  }
  
  // Add slight color variation
  const colorVariation = 0.1;
  const r = Math.max(0, Math.min(1, selectedType.color[0] + (Math.random() - 0.5) * colorVariation));
  const g = Math.max(0, Math.min(1, selectedType.color[1] + (Math.random() - 0.5) * colorVariation));
  const b = Math.max(0, Math.min(1, selectedType.color[2] + (Math.random() - 0.5) * colorVariation));
  
  starsColors.push(r, g, b);
  
  // Vary star sizes with distance and brightness
  const size = Math.random() * 3 + 0.5;
  starsSizes.push(size);
}

starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
starsGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starsColors, 3));
starsGeometry.setAttribute('size', new THREE.Float32BufferAttribute(starsSizes, 1));

// Create custom shader material for twinkling stars
const starShaderMaterial = new THREE.ShaderMaterial({
  uniforms: {
    time: { value: 0.0 },
    pixelRatio: { value: window.devicePixelRatio }
  },
  vertexShader: `
    attribute float size;
    uniform float time;
    uniform float pixelRatio;
    varying float intensity;
    varying float vTwinkle;
    
    void main() {
      vTwinkle = sin(time * 2.0 + position.x * 0.01 + position.y * 0.02);
      vTwinkle = 0.7 + 0.3 * vTwinkle;
      
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);
      gl_Position = projectionMatrix * mvPosition;
    }
  `,
  fragmentShader: `
    varying float intensity;
    varying float vTwinkle;
    
    void main() {
      float dist = distance(gl_PointCoord, vec2(0.5));
      
      // Create soft circular stars
      if (dist > 0.5) discard;
      
      float alpha = 1.0 - smoothstep(0.0, 0.5, dist);
      alpha *= vTwinkle;
      
      // Add subtle bloom effect
      vec3 finalColor = vec3(1.0) * (1.0 + 0.5 * alpha);
      
      gl_FragColor = vec4(finalColor, alpha * 0.9);
    }
  `,
  transparent: true,
  blending: THREE.AdditiveBlending,
  vertexColors: true,
  depthWrite: false
});

const starField = new THREE.Points(starsGeometry, starShaderMaterial);
const starFieldGroup = new THREE.Group();
starFieldGroup.add(starField);
scene.add(starFieldGroup);

const earthGeometry = new THREE.SphereGeometry(1, 128, 128);

// Create Earth material with enhanced properties
const earthMaterial = new THREE.MeshPhongMaterial({
  map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg'),
  bumpMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_normal_2048.jpg'),
  bumpScale: 0.08,
  specularMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg'),
  specular: new THREE.Color(0x666666),
  shininess: 100,
  transparent: false
});

const earth = new THREE.Mesh(earthGeometry, earthMaterial);
earth.castShadow = true;
earth.receiveShadow = true;
scene.add(earth);

// Enhanced atmosphere effect
const atmosphereGeometry = new THREE.SphereGeometry(1.02, 64, 64);
const atmosphereMaterial = new THREE.ShaderMaterial({
  uniforms: {
    viewVector: { type: "v3", value: camera.position }
  },
  vertexShader: `
    uniform vec3 viewVector;
    varying float intensity;
    varying vec3 vNormal;
    void main() {
      vNormal = vec3(modelMatrix * vec4(normal, 0.0));
      intensity = pow(dot(normalize(viewVector), vNormal), 2.0);
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    varying float intensity;
    varying vec3 vNormal;
    void main() {
      float pulse = sin(time * 2.0) * 0.1 + 0.9;
      vec3 ozoneColor = vec3(0.2, 0.7, 0.9) * pulse;
      float alpha = intensity * 0.4;
      gl_FragColor = vec4(ozoneColor, alpha);
    }
  `,
  side: THREE.BackSide,
  blending: THREE.AdditiveBlending,
  transparent: true,
  depthWrite: false
});

const atmosphereMesh = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
earth.add(atmosphereMesh);

// Add ozone layer effect
const ozoneGeometry = new THREE.SphereGeometry(1.015, 64, 64);
const ozoneMaterial = new THREE.ShaderMaterial({
  uniforms: {
    viewVector: { type: "v3", value: camera.position },
    time: { type: "f", value: 0.0 }
  },
  vertexShader: `
    uniform vec3 viewVector;
    uniform float time;
    varying float intensity;
    varying vec3 vNormal;
    void main() {
      vNormal = vec3(modelMatrix * vec4(normal, 0.0));
      intensity = pow(0.8 - dot(normalize(viewVector), vNormal), 3.0);
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,
  fragmentShader: `
    uniform float time;
    varying float intensity;
    varying vec3 vNormal;
    void main() {
      float pulse = sin(time * 2.0) * 0.1 + 0.9;
      vec3 ozoneColor = vec3(0.2, 0.7, 0.9) * pulse;
      float alpha = intensity * 0.4;
      gl_FragColor = vec4(ozoneColor, alpha);
    }
  `,
  side: THREE.BackSide,
  blending: THREE.AdditiveBlending,
  transparent: true,
  depthWrite: false
});

const ozoneMesh = new THREE.Mesh(ozoneGeometry, ozoneMaterial);
earth.add(ozoneMesh);

// Enhanced clouds with better opacity and movement
const cloudGeometry = new THREE.SphereGeometry(1.008, 64, 64);
const cloudMaterial = new THREE.MeshPhongMaterial({
  map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png'),
  transparent: true,
  opacity: 0.6,
  depthWrite: false,
  side: THREE.DoubleSide
});
const clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
earth.add(clouds);

function createMoon() {
  const moonGeometry = new THREE.SphereGeometry(0.27, 64, 64);
  
  // Enhanced moon material with better textures
  const moonMaterial = new THREE.MeshPhongMaterial({
    map: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/moon_1024.jpg'),
    bumpMap: new THREE.TextureLoader().load('https://threejs.org/examples/textures/planets/moon_bump.jpg'),
    bumpScale: 0.005,
    shininess: 10,
    specular: new THREE.Color(0x111111)
  });

  moon = new THREE.Mesh(moonGeometry, moonMaterial);
  moon.castShadow = true;
  moon.receiveShadow = true;
  
  moonOrbit = new THREE.Object3D();
  moonOrbit.add(moon);
  moon.position.x = 2.8;
  
  scene.add(moonOrbit);
}

createMoon();

// Enhanced lighting setup
const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
scene.add(ambientLight);

const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
directionalLight.position.set(5, 3, 5);
directionalLight.castShadow = true;
directionalLight.shadow.mapSize.width = 2048;
directionalLight.shadow.mapSize.height = 2048;
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 50;
directionalLight.shadow.camera.left = -10;
directionalLight.shadow.camera.right = 10;
directionalLight.shadow.camera.top = 10;
directionalLight.shadow.camera.bottom = -10;
scene.add(directionalLight);

// Add rim lighting for Earth
const rimLight = new THREE.DirectionalLight(0x00aaff, 0.5);
rimLight.position.set(-5, 2, -3);
scene.add(rimLight);

// Add warm fill light
const fillLight = new THREE.DirectionalLight(0xffaa00, 0.3);
fillLight.position.set(2, -3, 4);
scene.add(fillLight);

function animate() {
  requestAnimationFrame(animate);

  // Reduced animation complexity on Android for better performance
  const animationSpeed = isAndroid ? 0.5 : 1.0;

  starFieldGroup.rotation.y += 0.0003 * animationSpeed;
  starFieldGroup.rotation.x += 0.0001 * animationSpeed;
  
  // Update star twinkling with performance check
  if (starField.material.uniforms && (!isAndroid || Date.now() % 100 < 50)) {
    starField.material.uniforms.time.value = Date.now() * 0.001;
  }

  // Enhanced Earth rotation with slight wobble
  earth.rotation.y += 0.002 * animationSpeed;
  earth.rotation.x = Math.sin(Date.now() * 0.0001) * 0.02;
  
  // Enhanced cloud movement
  clouds.rotation.y += 0.0025 * animationSpeed;
  clouds.rotation.x += 0.0005 * animationSpeed;

  // Enhanced moon movement
  moon.rotation.y += 0.002 * animationSpeed;
  moonOrbit.rotation.y += 0.0015 * animationSpeed;
  
  // Update atmosphere effect (reduced frequency on mobile)
  if (atmosphereMesh && (!isMobile || Date.now() % 200 < 100)) {
    atmosphereMesh.material.uniforms.viewVector.value = new THREE.Vector3().subVectors(camera.position, earth.position);
  }

  // Update ozone layer effect (reduced frequency on mobile)
  if (ozoneMesh && (!isMobile || Date.now() % 200 < 100)) {
    ozoneMesh.material.uniforms.viewVector.value = new THREE.Vector3().subVectors(camera.position, earth.position);
    ozoneMesh.material.uniforms.time.value = Date.now() * 0.001;
  }

  updateCameraPosition();
  updateTimeCounter();

  // Render main scene only
  renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>